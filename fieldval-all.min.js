function extend(e,r){function t(){}t.prototype=r.prototype;var i=new t;for(var n in i)e.prototype[n]=i[n];e.prototype.constructor=e,e.superConstructor=r,e.superClass=r.prototype}function RuleField(e,r){var t=this;if(t.json=e,t.checks=[],t.validator="undefined"!=typeof r?r:new FieldVal(e),t.name=t.validator.get("name",BasicVal.string(!1)),t.display_name=t.validator.get("display_name",BasicVal.string(!1)),t.description=t.validator.get("description",BasicVal.string(!1)),t.type=t.validator.get("type",BasicVal.string(!0)),t.required=t.validator.default_value(!0).get("required",BasicVal.boolean(!1)),null!=e){var i=t.validator.get("exists",BasicVal.boolean(!1));null!=i&&(existsFilter=i?1:2)}}function BasicRuleField(e,r){BasicRuleField.superConstructor.call(this,e,r)}function TextRuleField(e,r){TextRuleField.superConstructor.call(this,e,r)}function NumberRuleField(e,r){NumberRuleField.superConstructor.call(this,e,r)}function ObjectRuleField(e,r){ObjectRuleField.superConstructor.call(this,e,r)}function ArrayRuleField(e,r){var t=this;ArrayRuleField.superConstructor.call(this,e,r),t.rules=[],t.fields=[],t.interval=null,t.interval_offsets=[]}function ChoiceRuleField(e,r){ChoiceRuleField.superConstructor.call(this,e,r)}function BooleanRuleField(e,r){BooleanRuleField.superConstructor.call(this,e,r)}function EmailRuleField(e,r){EmailRuleField.superConstructor.call(this,e,r)}function ValidationRule(){}function fieldval_ui_extend(e,r){function t(){}t.prototype=r.prototype,e.prototype=new t,e.prototype.constructor=e,e.superConstructor=r,e.superClass=r.prototype}function FVForm(e){var r=this;r.element=$("<form />").addClass("fv_form").append(r.error_message=$("<div />").addClass("fv_error_message").hide()).on("submit",function(e){return e.preventDefault(),r.submit(),!1}),r.fields=e||{},r.fields_element=r.element,r.submit_callbacks=[]}function Field(e,r){var t=this;t.name=e,t.options=r||{},t.show_on_form_flag=!0,t.is_in_array=!1,t.on_change_callbacks=[],t.element=$("<div />").addClass("fv_field").data("field",t),t.title=$("<div />").addClass("fv_field_title").text(t.name),t.options.description&&(t.description_label=$("<div />").addClass("fv_field_description").text(t.options.description)),t.input_holder=$("<div />").addClass("fv_input_holder"),t.error_message=$("<div />").addClass("fv_error_message").hide(),t.layout()}function TextField(e,r){var t=this,i=typeof r;"string"===i?(t.input_type=r,r={}):"object"===i?t.input_type=r.type||"text":r={},TextField.superConstructor.call(this,e,r),t.element.addClass("fv_text_field"),t.input=$("textarea"===t.input_type?"<textarea />":"text"!==t.input_type&&"number"!==t.input_type&&t.input_type?"<input type='"+t.input_type+"' />":"<input type='text' />"),t.enter_callbacks=[],t.input.addClass("fv_text_input").attr("placeholder",e).on("keydown",function(e){if(13===e.keyCode)for(var r=0;r<t.enter_callbacks.length;r++)t.enter_callbacks[r](e)}).on("keyup",function(){t.did_change()}).appendTo(t.input_holder)}function PasswordField(e){PasswordField.superConstructor.call(this,e,"password")}function DisplayField(e,r){var t=this;DisplayField.superConstructor.call(this,e,r),t.element.addClass("fv_display_field"),t.input=$("<div />").appendTo(t.input_holder),t.hide_on_form()}function ChoiceField(e,r){var t=this;ChoiceField.superConstructor.call(this,e,r),t.choices=t.options.choices||[],t.allow_empty=t.options.allow_empty||!1,t.element.addClass("fv_choice_field"),t.select=$("<select/>").addClass("fv_choice_input").appendTo(t.input_holder),setTimeout(function(){t.select.on("change",function(){t.did_change()})},100),t.choice_values=[],t.allow_empty&&(t.empty_option=$("<option />").attr({value:null}).text(t.options.empty_message||""),t.select.append(t.empty_option));for(var i=0;i<t.choices.length;i++){var n,a,o=t.choices[i];"object"==typeof o?(n=o[0],a=o[1]):n=a=o,t.choice_values.push(n);var l=$("<option />").attr("value",n).text(a);t.select.append(l)}}function DateField(e,r){var t=this;if("undefined"==typeof DateVal)return void console.error("DateField requires fieldval-dateval-js");DateField.superConstructor.call(this,e,r),t.element.addClass("fv_date_field"),t.format_string=t.options.format||"yyyy-MM-dd";var i=DateVal.date_format().check(t.format_string,function(e){t.format_array=e});if(i)return void console.error(i.error_message);t.inputs=[];for(var n=0;n<t.format_array.length;n++){var a=t.format_array[n],o=DateVal.date_components[a];t.add_element_from_component(a,o)}}function BooleanField(e,r){var t=this;BooleanField.superConstructor.call(this,e,r),t.element.addClass("fv_boolean_field"),t.input=$("<input type='checkbox' />").addClass("fv_boolean_input").on("change",function(){t.did_change()}).appendTo(t.input_holder)}function ObjectField(e,r){var t=this;ObjectField.superConstructor.call(this,e,r),t.element.addClass("fv_object_field"),t.fields_element=t.input_holder,t.fields={}}function ArrayField(e,r){var t=this;ArrayField.superConstructor.call(this,e,r),t.fields=[],t.add_field_buttons=[],t.element.addClass("fv_array_field"),t.input_holder.append(t.fields_element=$("<div />").addClass("fv_nested_fields"),t.create_add_field_button()),t.input_holder.nestable({rootClass:"fv_input_holder",itemClass:"fv_field",handleClass:"fv_field_move_handle",itemNodeName:"div.fv_field",listNodeName:"div.fv_nested_fields",collapseBtnHTML:"",expandBtnHTML:"",maxDepth:1}).on("change",function(){t.reorder()})}var FieldVal=function(){"use strict";function e(r,t){var i=this;if(i.async_waiting=0,i.validating=r,i.missing_keys={},i.invalid_keys={},i.unrecognized_keys={},i.recognized_keys={},i.errors=[],void 0!==t)if(t){var n;if(t.error===e.ONE_OR_MORE_ERRORS)n=t;else if(t.error===e.MULTIPLE_ERRORS)for(var a=0;a<t.errors.length;a++){var o=t.errors[a];0!==o.error?i.errors.push(o):n=o}else i.errors.push(t);if(n){for(var l in r)r.hasOwnProperty(l)&&(i.recognized_keys[l]=!0);if(n.missing&&(i.missing_keys=n.missing),n.unrecognized){i.unrecognized_keys=n.unrecognized;for(var s in i.unrecognized_keys)i.unrecognized_keys.hasOwnProperty(s)&&delete i.recognized_keys[s]}n.invalid&&(i.invalid_keys=n.invalid)}}else for(var l in r)r.hasOwnProperty(l)&&(i.recognized_keys[l]=!0)}Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)});var r=function(e){var r;for(r in e)if(e.hasOwnProperty(r))return!1;return!0};return e.prototype.dig=function(){var r,t=this,i=arguments[0];r=Array.isArray(i)?i:arguments;for(var n=t.validating,a=t,o=0;o<r.length;o++){var l=r[o];if(n=n[l],void 0===n)return void 0;if(a){var s;s=a instanceof e?a.invalid_keys:a.invalid,s&&(a=s[l])}}return new e(n,a)},e.prototype.invalid=function(){var r,t,i=this,n=arguments[arguments.length-1];if(2===arguments.length){var a=arguments[0];if(!Array.isArray(a))return i.invalid_keys[arguments[0]]=e.add_to_invalid(n,i.invalid_keys[arguments[0]]),i;r=a,t=a.length}else r=arguments,t=arguments.length-1;for(var o=i,l=0;t>l;l++){var s,d=r[l];s=o instanceof e?o.invalid_keys:o.invalid;var u;u=l===t-1?n:s[d],u||(u={error:e.ONE_OR_MORE_ERRORS,error_message:e.ONE_OR_MORE_ERRORS_STRING,invalid:{}}),o instanceof e?o.invalid(d,u):s[d]=e.add_to_invalid(u,s[d]),o=u}return i},e.prototype.default_value=function(e){var r=this;return{get:function(){var t=r.get.apply(r,arguments);return void 0!==t?t:e}}},e.prototype.get=function(r){var t,i=this,n=Array.prototype.slice.call(arguments,1),a=!1,o=i.get_async(r,n,function(e){a=!0,t=e});if(o===e.ASYNC)throw new Error(".get used with async checks, use .get_async.");return t},e.prototype.get_async=function(r,t,i){var n=this;if(!Array.isArray(t))throw new Error(".get_async second argument must be an array of checks");var a=n.validating[r];n.recognized_keys[r]=!0;var o=e.use_checks(a,t,{validator:n,field_name:r,emit:function(e){a=e}},function(){void 0!==i&&i(a)});return o===e.ASYNC?e.ASYNC:void 0},e.prototype.error=function(e){var r=this;return r.errors.push(e),r},e.add_to_invalid=function(r,t){if(void 0!==t){if(void 0!==t.errors){for(var i=0;i<t.errors.length;i++){var n=t.errors;void 0!==n.error&&n.error===r.error&&(t.errors[i]=r)}t.errors.push(r)}else t=void 0!==t.error&&t.error===r.error?r:{error:e.MULTIPLE_ERRORS,error_message:"Multiple errors.",errors:[t,r]};return t}return r},e.prototype.missing=function(r,t){var i=this;return i.missing_keys[r]=e.create_error(e.MISSING_ERROR,t),i},e.prototype.unrecognized=function(r){var t=this;return t.unrecognized_keys[r]={error_message:"Unrecognized field.",error:e.FIELD_UNRECOGNIZED},t},e.prototype.recognized=function(e){var r=this;return r.recognized_keys[e]=!0,r},e.prototype.get_unrecognized=function(){var e,r=this,t=[];for(e in r.validating)r.validating.hasOwnProperty(e)&&r.recognized_keys[e]!==!0&&t.push(e);return t},e.prototype.async_call_ended=function(){var e=this;e.async_waiting--,e.async_waiting<=0&&e.end_callback&&e.end_callback(e.generate_response(),e.recognized_keys)},e.prototype.generate_response=function(){var t,i=this,n={},a=!1,o={};for(t in i.unrecognized_keys)i.unrecognized_keys.hasOwnProperty(t)&&(o[t]=i.unrecognized_keys[t]);var l,s,d=i.get_unrecognized();for(l=0;l<d.length;l++)s=d[l],o[s]||(o[s]={error_message:"Unrecognized field.",error:e.FIELD_UNRECOGNIZED});if(r(i.missing_keys)||(n.missing=i.missing_keys,a=!0),r(i.invalid_keys)||(n.invalid=i.invalid_keys,a=!0),r(o)||(n.unrecognized=o,a=!0),a){if(n.error_message=e.ONE_OR_MORE_ERRORS_STRING,n.error=e.ONE_OR_MORE_ERRORS,0===i.errors.length)return n;i.errors.push(n)}return 0!==i.errors.length?1===i.errors.length?i.errors[0]:{error:e.MULTIPLE_ERRORS,error_message:"Multiple errors.",errors:i.errors}:null},e.prototype.end=function(e){var r=this;return e?(r.end_callback=e,void(r.async_waiting<=0&&e(r.generate_response(),r.recognized_keys))):r.generate_response()},e.prototype.end_with_recognized=function(e){var r=this;if(e)r.end(e);else if(r.async_waiting>0)return[r.generate_response(),r.recognized_keys]},e.ASYNC=-1,e.REQUIRED_ERROR=Math.sqrt,e.NOT_REQUIRED_BUT_MISSING=Math.floor,e.ONE_OR_MORE_ERRORS=0,e.ONE_OR_MORE_ERRORS_STRING="One or more errors.",e.FIELD_MISSING=1,e.INCORRECT_FIELD_TYPE=2,e.FIELD_UNRECOGNIZED=3,e.MULTIPLE_ERRORS=4,e.INCORRECT_TYPE_ERROR=function(r,t){return{error_message:"Incorrect field type. Expected "+r+".",error:e.INCORRECT_FIELD_TYPE,expected:r,received:t}},e.MISSING_ERROR=function(){return{error_message:"Field missing.",error:e.FIELD_MISSING}},e.get_value_and_type=function(e,r,t){t||(t={});var i=void 0!==t.parse?t.parse:!1;if("string"!=typeof e||i)if("integer"===r){var n=parseInt(e,10);isNaN(n)||n.toString().length!==e.toString().length||(e=n,r=n,r="number")}else if("float"===r||"number"===r){var a=parseFloat(e,10);isNaN(a)||a.toString().length!==e.toString().length||(e=a,r="number")}var o=typeof e;return"object"===o&&Array.isArray(e)&&(o="array"),{type:o,desired_type:r,value:e}},e.use_check=function(r,t,i){var n,a=!0,o={},l=0;if("object"==typeof r){if(Array.isArray(r)){var s=!1,d=r,u=!1,c=function(){if(l++,t.stop||l>d.length)return u=!0,void i();var r=e.use_check(d[l-1],t,function(){c()});r===e.ASYNC&&(s=!0)};return c(),u?s?e.ASYNC:void 0:e.ASYNC}o=r,n=o.check,o&&void 0!==o.stop_on_error&&(a=o.stop_on_error)}else{if("function"!=typeof r)throw new Error("A check can only be provided as a function or as an object with a function as the .check property.");n=r,a=!0}var f=function(r){if(null!==r&&void 0!==r){if(a&&(t.stop=!0),t.had_error=!0,r===e.REQUIRED_ERROR)return void 0!==t.field_name?(t.validator.missing(t.field_name,o),void i()):t.existing_validator?(t.validator.error(e.create_error(e.MISSING_ERROR,o)),void i()):(t.return_missing=!0,void i());r===e.NOT_REQUIRED_BUT_MISSING?i():t.existing_validator?(t.field_name?t.validator.invalid(t.field_name,r):t.validator.error(r),i()):(t.validator.error(r),i())}else i()},p=n(t.value,t.emit,function(e){f(e)});return 3===n.length?e.ASYNC:(f(p),null)},e.use_checks=function(r,t,i,n){"function"==typeof i&&(n=i,i=void 0),i||(i={});var a={value:r,field_name:i.field_name,emit:function(e){a.value=e},options:i,stop:!1,return_missing:!1,had_error:!1};i.validator?(a.validator=i.validator,a.existing_validator=!0):a.validator=new e;var o,l=!1,s=function(e){o=e,l=!0,n&&n(e)};a.validator.async_waiting++;var d=e.use_check(t||[],a,function(){return a.had_error?a.options.emit&&a.options.emit(void 0):a.options.emit&&a.options.emit(a.value),a.return_missing?(s(e.REQUIRED_ERROR),void a.validator.async_call_ended()):a.existing_validator?(s(null),void a.validator.async_call_ended()):(s(a.validator.end()),void a.validator.async_call_ended())});return d===e.ASYNC?(n&&(s=n),e.ASYNC):l?o:e.ASYNC},e.required=function(r,t){var i=function(t){return null===t||void 0===t?r||void 0===r?e.REQUIRED_ERROR:e.NOT_REQUIRED_BUT_MISSING:void 0};return void 0!==t?(t.check=i,t):i},e.type=function(r,t){var i=t&&void 0!==t.required?t.required:!0,n=function(n,a){var o=e.required(i)(n);if(o)return o;var l=e.get_value_and_type(n,r,t),s=l.desired_type,d=l.type;return n=l.value,d!==s?e.create_error(e.INCORRECT_TYPE_ERROR,t,s,d):void(a&&a(n))};return void 0!==t?(t.check=n,t):n},e.create_error=function(r,t){if(!t)return r.apply(null,Array.prototype.slice.call(arguments,2));if(r===e.MISSING_ERROR){var i=typeof t.missing_error;if("function"===i)return t.missing_error.apply(null,Array.prototype.slice.call(arguments,2));if("object"===i)return t.missing_error;if("string"===i)return{error_message:t.missing_error}}else{var n=typeof t.error;if("function"===n)return t.error.apply(null,Array.prototype.slice.call(arguments,2));if("object"===n)return t.error;if("string"===n)return{error_message:t.error}}return r.apply(null,Array.prototype.slice.call(arguments,2))},e}.call();"undefined"!=typeof module&&(module.exports=FieldVal);var BasicVal=function(){"function"==typeof require&&(FieldVal=require("fieldval")),Array.prototype.indexOf||(Array.prototype.indexOf=function(e,r){var t;if(null==this)throw new TypeError('"this" is null or not defined');var i=Object(this),n=i.length>>>0;if(0===n)return-1;var a=+r||0;if(1/0===Math.abs(a)&&(a=0),a>=n)return-1;for(t=Math.max(a>=0?a:n-Math.abs(a),0);n>t;){if(t in i&&i[t]===e)return t;t++}return-1});var e={errors:{too_short:function(e){return{error:100,error_message:"Length is less than "+e}},too_long:function(e){return{error:101,error_message:"Length is greater than "+e}},too_small:function(e){return{error:102,error_message:"Value is less than "+e}},too_large:function(e){return{error:103,error_message:"Value is greater than "+e}},not_in_list:function(){return{error:104,error_message:"Value is not a valid choice"}},cannot_be_empty:function(){return{error:105,error_message:"Value cannot be empty."}},no_prefix:function(e){return{error:106,error_message:"Value does not have prefix: "+e}},invalid_email:function(){return{error:107,error_message:"Invalid email address format."}},invalid_url:function(){return{error:108,error_message:"Invalid url format."}},incorrect_length:function(e){return{error:109,error_message:"Length is not equal to "+e}},no_suffix:function(e){return{error:110,error_message:"Value does not have suffix: "+e}},not_equal:function(e){return{error:113,error_message:"Not equal to "+e+"."}},no_valid_option:function(){return{error:115,error_message:"None of the options were valid."}},contains_whitespace:function(){return{error:116,error_message:"Contains whitespace."}},must_start_with_letter:function(){return{error:117,error_message:"Must start with a letter."}},value_in_list:function(){return{error:104,error_message:"Value not allowed"}}},equal_to:function(r,t){var i=function(i){return i!==r?FieldVal.create_error(e.errors.not_equal,t,r):void 0};return t?(t.check=i,t):{check:i}},merge_required_and_flags:function(e,r){return"object"==typeof e?r=e:(r||(r={}),r.required=e),r},integer:function(r,t){return FieldVal.type("integer",e.merge_required_and_flags(r,t))},number:function(r,t){return FieldVal.type("number",e.merge_required_and_flags(r,t))},array:function(r,t){return FieldVal.type("array",e.merge_required_and_flags(r,t))},object:function(r,t){return FieldVal.type("object",e.merge_required_and_flags(r,t))},"float":function(r,t){return FieldVal.type("float",e.merge_required_and_flags(r,t))},"boolean":function(r,t){return FieldVal.type("boolean",e.merge_required_and_flags(r,t))},string:function(r,t){t=e.merge_required_and_flags(r,t);var i=function(e,i){var n=FieldVal.type("string",t);"object"==typeof n&&(n=n.check);var a=n(e,i);return a?a:(t&&t.trim===!1||(e=e.trim()),0===e.length?r||void 0===r?FieldVal.REQUIRED_ERROR:FieldVal.NOT_REQUIRED_BUT_MISSING:void 0)};return t?(t.check=i,t):{check:i}},length:function(r,t){var i=function(i){return i.length!==r?FieldVal.create_error(e.errors.incorrect_length,t,r):void 0};return t?(t.check=i,t):{check:i}},min_length:function(r,t){var i=function(i){return i.length<r?FieldVal.create_error(e.errors.too_short,t,r):void 0};return t?(t.check=i,t):{check:i}},max_length:function(r,t){var i=function(i){return i.length>r?FieldVal.create_error(e.errors.too_long,t,r):void 0};return t?(t.check=i,t):{check:i}},no_whitespace:function(r){var t=function(t){return/\s/.test(t)?FieldVal.create_error(e.errors.contains_whitespace,r,max_len):void 0};return r?(r.check=t,r):{check:t}},minimum:function(r,t){var i=function(i){return r>i?FieldVal.create_error(e.errors.too_small,t,r):void 0};return t?(t.check=i,t):{check:i}},maximum:function(r,t){var i=function(i){return i>r?FieldVal.create_error(e.errors.too_large,t,r):void 0};return t?(t.check=i,t):{check:i}},range:function(r,t,i){var n=function(n){return r>n?FieldVal.create_error(e.errors.too_small,i,r):n>t?FieldVal.create_error(e.errors.too_large,i,t):void 0};return i?(i.check=n,i):{check:n}},one_of:function(r,t){var i=[];if("[object Array]"===Object.prototype.toString.call(r))for(var n=0;n<r.length;n++){var a=r[n];i.push("object"==typeof a?a[0]:a)}else for(var o in r)i.push(o);var l=function(r){return-1===i.indexOf(r)?FieldVal.create_error(e.errors.not_in_list,t):void 0};return t?(t.check=l,t):{check:l}},not_one_of:function(r,t){var i=[];if("[object Array]"===Object.prototype.toString.call(r))for(var n=0;n<r.length;n++){var a=r[n];i.push("object"==typeof a?a[0]:a)}else for(var o in r)i.push(o);var l=function(r){return-1!==i.indexOf(r)?FieldVal.create_error(e.errors.value_in_list,t):void 0};return t?(t.check=l,t):{check:l}},not_empty:function(r,t){var i=function(i){if(r){if(0===i.trim().length)return FieldVal.create_error(e.errors.cannot_be_empty,t)}else if(0===i.length)return FieldVal.create_error(e.errors.cannot_be_empty,t)};return t?(t.check=i,t):{check:i}},prefix:function(r,t){var i=function(i){return i.length>=r.length?i.substring(0,r.length)!=r?FieldVal.create_error(e.errors.no_prefix,t,r):void 0:FieldVal.create_error(e.errors.no_prefix,t,r)};return t?(t.check=i,t):{check:i}},start_with_letter:function(r){var t=function(t){if(!(t.length>0))return FieldVal.create_error(e.errors.must_start_with_letter,r);var i=t.charCodeAt(0);return i>=65&&90>=i||i>=97&&122>=i?void 0:FieldVal.create_error(e.errors.must_start_with_letter,r)};return r?(r.check=t,r):{check:t}},suffix:function(r,t){var i=function(i){return i.length>=r.length?i.substring(i.length-r.length,i.length)!=r?FieldVal.create_error(e.errors.no_suffix,t,r):void 0:FieldVal.create_error(e.errors.no_suffix,t,r)};return t?(t.check=i,t):{check:i}},each:function(e,r){var t=function(r){for(var t=new FieldVal(null),i=0;i<r.length;i++){var n=r[i],a=e(n,i);a===FieldVal.REQUIRED_ERROR?t.missing(""+i):null!=a&&t.invalid(""+i,a)}var o=t.end();return null!=o?o:void 0};return r?(r.check=t,r):{check:t}},each_async:function(e,r){var t=function(e,r,t){new FieldVal(null)};return r?(r.check=t,r):{check:t}},multiple:function(r,t){r=r||[],0===r.length&&console.error("BasicVal.multiple called without possibles.");var i=function(i,n){for(var a=0;a<r.length;a++){var o,l=r[a],s=FieldVal.use_checks(i,l,null,null,function(e){o=e});if(!s)return void 0!==o&&n(o),null}return FieldVal.create_error(e.errors.no_valid_option,t)};return t?(t.check=i,t):{check:i}},multiple_async:function(r,t){if(r=r||[],0===r.length)return void console.error("BasicVal.multiple_async called without possibles.");var i,n=function(n,a,o){var l,s=function(e){l=e},d=0,u=function(){if(d++,d>r.length)return void o(FieldVal.create_error(e.errors.no_valid_option,t));var i=r[d-1];FieldVal.use_checks(n,i,{field_name:null,validator:null,emit:s},function(e){void 0===e?o(void 0):u()})};return u(),i};return t?(t.check=n,t):{check:n}},email:function(r){var t=function(t){var i=e.email_regex;return i.test(t)?void 0:FieldVal.create_error(e.errors.invalid_email,r)};return r?(r.check=t,r):{check:t}},url:function(r){var t=function(t){var i=e.url_regex;return i.test(t)?void 0:FieldVal.create_error(e.errors.invalid_url,r)};return r?(r.check=t,r):{check:t}}};return e.email_regex=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,e.url_regex=/^(https?):\/\/(((([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5]))|((([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9])))(:[1-9][0-9]+)?(\/)?([\/?].+)?$/,e}.call();"undefined"!=typeof module&&(module.exports=BasicVal),"function"==typeof require&&(FieldVal=require("fieldval"),BasicVal=require("fieldval-basicval"));var DateVal={errors:{invalid_date_format:function(){return{error:111,error_message:"Invalid date format."}},invalid_date:function(){return{error:112,error_message:"Invalid date."}},invalid_date_format_string:function(){return{error:114,error_message:"Invalid date format string."}}},date_format:function(e){var r=function(r,t){for(var i=[],n=0,a=!1;n<r.length&&!a;){var o=!1;for(var l in DateVal.date_components){var s=r.substring(n,n+l.length);if(s===l){i.push(l),n+=l.length,o=!0;break}}o||(a=!0)}return a?FieldVal.create_error(DateVal.errors.invalid_date_format_string,e):void t(i)};return e?(e.check=r,e):{check:r}},date_with_format_array:function(e,r){for(var t="",i=0;i<r.length;i++){var n=r[i],a=DateVal.date_components[n];if(0===a)t+=n;else{var o;"yyyy"===n?o=e.getUTCFullYear():"yy"===n?o=e.getUTCFullYear().toString().substring(2):"MM"===n||"M"===n?o=e.getUTCMonth()+1:"dd"===n||"d"===n?o=e.getUTCDate():"hh"===n||"h"===n?o=e.getUTCHours():"mm"===n||"m"===n?o=e.getUTCMinutes():("ss"===n||"s"===n)&&(o=e.getUTCSeconds()),t+=DateVal.pad_to_valid(o.toString(),a)}}return t},pad_to_valid:function(e,r){for(var t=0;t<r.length;t++){var i=r[t];if(e.length<=i){for(var n=i-e.length,a=0;n>a;a++)e="0"+e;return e}}return e},date:function(e,r){r=r||{};var t,i=DateVal.date_format().check(e,function(e){t=e});i&&console.error&&console.error(i.error_message);var n=function(e,i){for(var n={},a=[],o=0,l=null,s=null,d=-1,u=!1;o<e.length&&!u;)if(d++,l=t[d],s=DateVal.date_components[l],0!==s){for(var c=s[0],f=s[s.length-1],p="",_=0;f>_;_++){var h=e[o+_];if(void 0===h)break;var v=h.charCodeAt(0);if(48>v||v>57){if(_===c)break;u=!0;break}p+=h}if(o+=_,u)break;var m=parseInt(p);a.push(p),"yyyy"===l||"yy"===l?n.year=m:"MM"===l||"M"===l?n.month=m:"dd"===l||"d"===l?n.day=m:"hh"===l||"h"===l?n.hour=m:"mm"===l||"m"===l?n.minute=m:("ss"===l||"s"===l)&&(n.second=m)}else{if(e[o]!==l){u=!0;break}a.push(null),o++}if(u)return FieldVal.create_error(DateVal.errors.invalid_date_format,r);if(void 0!==n.hour&&(n.hour<0||n.hour>23))return FieldVal.create_error(DateVal.errors.invalid_date,r);if(void 0!==n.minute&&(n.minute<0||n.minute>59))return FieldVal.create_error(DateVal.errors.invalid_date,r);if(void 0!==n.second&&(n.second<0||n.second>59))return FieldVal.create_error(DateVal.errors.invalid_date,r);if(void 0!==n.month){var y=n.month;if(y>12)return FieldVal.create_error(DateVal.errors.invalid_date,r);if(1>y)return FieldVal.create_error(DateVal.errors.invalid_date,r);if(n.day){var g=n.day;if(1>g)return FieldVal.create_error(DateVal.errors.invalid_date,r);if(n.year){var F=n.year;if(2==y)if(F%400===0||F%100!==0&&F%4===0){if(g>29)return FieldVal.create_error(DateVal.errors.invalid_date,r)}else if(g>28)return FieldVal.create_error(DateVal.errors.invalid_date,r)}if(4===y||6===y||9===y||11===y){if(g>30)return FieldVal.create_error(DateVal.errors.invalid_date,r)}else if(2===y){if(g>29)return FieldVal.create_error(DateVal.errors.invalid_date,r)}else if(g>31)return FieldVal.create_error(DateVal.errors.invalid_date,r)}}else if(n.day){if(n.day>31)return FieldVal.create_error(DateVal.errors.invalid_date,r);if(n.day<1)return FieldVal.create_error(DateVal.errors.invalid_date,r)}if(r.emit)if(r.emit===DateVal.EMIT_COMPONENT_ARRAY)i(a);else if(r.emit===DateVal.EMIT_OBJECT)i(n);else if(r.emit===DateVal.EMIT_DATE){var R=new Date(0);R.setUTCFullYear(0),void 0!==n.year&&R.setYear(n.year),void 0!==n.month&&R.setUTCMonth(n.month-1),void 0!==n.day&&R.setUTCDate(n.day),void 0!==n.hour&&R.setUTCHours(n.hour),void 0!==n.minute&&R.setUTCMinutes(n.minute),void 0!==n.second&&R.setUTCSeconds(n.second),i(R)}};return r?(r.check=n,r):{check:n}}};DateVal.EMIT_COMPONENT_ARRAY={},DateVal.EMIT_DATE={},DateVal.EMIT_OBJECT={},DateVal.date_components={yyyy:[4],yy:[2],MM:[2],M:[1,2],dd:[2],d:[1,2],hh:[2],h:[1,2],mm:[2],m:[1,2],ss:[2],s:[1,2]," ":0,"-":0,"/":0,":":0},"undefined"!=typeof module&&(module.exports=DateVal),"undefined"!=typeof module&&(module.exports=extend),RuleField.types={},RuleField.add_field_type=function(e){RuleField.types[e.name]={display_name:e.display_name,"class":e.class}},RuleField.create_field=function(e,r){var t=null,i=BasicVal.object(!0).check(e);if(i)return[i,null];var n=new FieldVal(e);if(r&&void 0!==r.need_name&&r.need_name===!0){var a=[BasicVal.string(!0)];r.existing_names&&a.push(BasicVal.not_one_of(r.existing_names,{error:{error:1e3,error_message:"Name already used"}})),n.get("name",a)}var o=n.get("type",BasicVal.string(!0),BasicVal.one_of(RuleField.types));if(!o)return[n.end(),null];var l=RuleField.types[o],s=l.class;t=new s(e,n);var d=t.init();return null!=d?[d,null]:[null,t]},RuleField.prototype.validate_as_field=function(e,r){var t=this,i=r.get(e,t.checks);return i},RuleField.prototype.validate=function(e){var r=this,t=new FieldVal(null),i=FieldVal.use_checks(e,r.checks);return i&&t.error(i),t.end()},RuleField.prototype.make_nested=function(){},RuleField.prototype.init=function(){},RuleField.prototype.remove=function(){},RuleField.prototype.view_mode=function(){},RuleField.prototype.edit_mode=function(){},RuleField.prototype.change_name=function(){},RuleField.prototype.disable=function(){},RuleField.prototype.enable=function(){},RuleField.prototype.focus=function(){},RuleField.prototype.blur=function(){},RuleField.prototype.val=function(){},"undefined"!=typeof module&&(module.exports=RuleField),"function"==typeof require&&(extend=require("extend")),extend(BasicRuleField,RuleField),BasicRuleField.prototype.init=function(){var e=this;return e.ui_field.init.apply(e.ui_field,arguments)},BasicRuleField.prototype.remove=function(){var e=this;return e.ui_field.remove.apply(e.ui_field,arguments)},BasicRuleField.prototype.in_array=function(){var e=this;return e.ui_field.in_array.apply(e.ui_field,arguments)},BasicRuleField.prototype.view_mode=function(){var e=this;return e.ui_field.view_mode.apply(e.ui_field,arguments)},BasicRuleField.prototype.edit_mode=function(){var e=this;return e.ui_field.edit_mode.apply(e.ui_field,arguments)},BasicRuleField.prototype.change_name=function(){var e=this;return e.ui_field.change_name.apply(e.ui_field,arguments)},BasicRuleField.prototype.disable=function(){var e=this;return e.ui_field.disable.apply(e.ui_field,arguments)},BasicRuleField.prototype.val=function(){var e=this;return e.ui_field.val.apply(e.ui_field,arguments)},BasicRuleField.prototype.error=function(){var e=this;return e.ui_field.error.apply(e.ui_field,arguments)},BasicRuleField.prototype.blur=function(){var e=this;return e.ui_field.blur.apply(e.ui_field,arguments)},BasicRuleField.prototype.focus=function(){var e=this;return e.ui_field.blur.apply(e.ui_field,arguments)},"undefined"!=typeof module&&(module.exports=BasicRuleField),"function"==typeof require&&(extend=require("extend"),BasicRuleField=require("./BasicRuleField")),extend(TextRuleField,BasicRuleField),TextRuleField.prototype.create_ui=function(e){var r=this;return r.ui_field=new TextField(r.display_name||r.name,r.json),r.element=r.ui_field.element,e.add_field(r.name,r),r.ui_field},TextRuleField.prototype.init=function(){var e=this;return e.checks.push(BasicVal.string(e.required)),e.min_length=e.validator.get("min_length",BasicVal.integer(!1)),void 0!==e.min_length&&e.checks.push(BasicVal.min_length(e.min_length,{stop_on_error:!1})),e.max_length=e.validator.get("max_length",BasicVal.integer(!1)),void 0!==e.max_length&&e.checks.push(BasicVal.max_length(e.max_length,{stop_on_error:!1})),e.phrase=e.validator.get("phrase",BasicVal.string(!1)),e.equal_to=e.validator.get("equal_to",BasicVal.string(!1)),e.ci_equal_to=e.validator.get("ci_equal_to",BasicVal.string(!1)),e.prefix=e.validator.get("prefix",BasicVal.string(!1)),e.ci_prefix=e.validator.get("ci_prefix",BasicVal.string(!1)),e.query=e.validator.get("query",BasicVal.string(!1)),e.validator.end()},"undefined"!=typeof module&&(module.exports=TextRuleField),"function"==typeof require&&(extend=require("extend"),BasicRuleField=require("./BasicRuleField")),extend(NumberRuleField,BasicRuleField),NumberRuleField.prototype.create_ui=function(e){var r=this;return r.ui_field=new TextField(r.display_name||r.name,r.json),r.element=r.ui_field.element,e.add_field(r.name,r),r.ui_field},NumberRuleField.prototype.init=function(){var e=this;return e.checks.push(BasicVal.number(e.required)),e.minimum=e.validator.get("minimum",BasicVal.number(!1)),null!=e.minimum&&e.checks.push(BasicVal.minimum(e.minimum,{stop_on_error:!1})),e.maximum=e.validator.get("maximum",BasicVal.number(!1)),null!=e.maximum&&e.checks.push(BasicVal.maximum(e.maximum,{stop_on_error:!1})),e.integer=e.validator.get("integer",BasicVal.boolean(!1)),e.integer&&e.checks.push(BasicVal.integer(!1,{stop_on_error:!1})),e.validator.end()},"undefined"!=typeof module&&(module.exports=NumberRuleField),"function"==typeof require&&(extend=require("extend"),BasicRuleField=require("./BasicRuleField")),extend(ObjectRuleField,BasicRuleField),ObjectRuleField.prototype.create_ui=function(e,r){var t=this;if(t.json.any)t.ui_field=new TextField(t.display_name||t.name,{type:"textarea"}),t.ui_field.val=function(e){var r=this;if(0===arguments.length){var t=r.input.val();if(0===t.length)return null;try{return JSON.parse(t)}catch(i){console.error("FAILED TO PARSE: ",t)}return t}return r.input.val(JSON.stringify(e,null,4)),r},t.element=t.ui_field.element;else{t.ui_field=r?r:new ObjectField(t.display_name||t.name,t.json);for(var i in t.fields){var n=t.fields[i];n.create_ui(t.ui_field)}t.element=t.ui_field.element}return r||e.add_field(t.name,t.ui_field),t.ui_field},ObjectRuleField.prototype.init=function(){var e=this;e.checks.push(BasicVal.object(e.required)),e.fields={};var r=e.validator.get("fields",BasicVal.array(!1));if(null!=r){for(var t=new FieldVal(null),i=0;i<r.length;i++){var n=r[i],a=RuleField.create_field(n,{need_name:!0,existing_names:e.fields}),o=a[0],l=a[1];null==o?e.fields[l.name]=l:t.invalid(i,o)}var s=t.end();null!=s&&e.validator.invalid("fields",s)}return e.any=e.validator.get("any",BasicVal.boolean(!1)),e.any||e.checks.push(function(r){var t=new FieldVal(r);for(var i in e.fields){var n=e.fields[i];n.validate_as_field(i,t)}var a=t.end();return a}),e.validator.end()},"undefined"!=typeof module&&(module.exports=ObjectRuleField),"function"==typeof require&&(extend=require("extend"),BasicRuleField=require("./BasicRuleField"),ValidationRule=require("../ValidationRule")),extend(ArrayRuleField,BasicRuleField),ArrayRuleField.prototype.create_ui=function(e){var r=this;r.ui_field=new ArrayField(r.display_name||r.name,r.json),r.ui_field.new_field=function(e){return r.new_field(e)};var t=r.ui_field.remove_field;return r.ui_field.remove_field=function(e){for(var i=0;i<r.fields.length;i++)r.fields[i]===e&&r.fields.splice(i,1);
return t.call(r.ui_field,e)},r.element=r.ui_field.element,e.add_field(r.name,r),r.ui_field},ArrayRuleField.prototype.new_field=function(e){var r=this,t=r.rule_for_index(e);return t.create_ui(r.ui_field)},ArrayRuleField.prototype.rule_for_index=function(e){var r=this,t=r.rules[e];if(!t){{var i=r.rule_json_for_index(e),n=RuleField.create_field(i);n[0]}t=n[1],r.rules[e]=t}return t},ArrayRuleField.prototype.rule_json_for_index=function(e){var r=this,t=r.indices[e];if(!t&&r.interval){var i=e%r.interval;t=r.interval_offsets[i]}return t||(t=r.indices["*"]),t},ArrayRuleField.integer_regex=/^(\d+)$/,ArrayRuleField.interval_regex=/^(\d+)n(\+(\d+))?$/,ArrayRuleField.prototype.init=function(){var e=this;e.checks.push(BasicVal.array(e.required)),e.indices={};var r=e.validator.get("indices",BasicVal.object(!1));if(null!=r){var t=new FieldVal(null);for(var i in r){var n=r[i],a=RuleField.create_field(n),o=a[0];if(null==o){var l=i.match(ArrayRuleField.interval_regex);if(l){var s=l[1],d=l[3]||0;if(e.interval&&s!==e.interval){t.invalid(i,FieldVal.create_error(ValidationRule.errors.interval_conflict,{},s,e.interval));continue}e.interval=s,e.interval_offsets[d]=n}else{var u=i.match(ArrayRuleField.integer_regex);if(u){var c=u[1];e.indices[c]=n}else"*"===i?e.indices["*"]=n:t.invalid(i,FieldVal.create_error(ValidationRule.errors.invalid_indices_format,{}))}}else t.invalid(i,o)}var f=t.end();f&&e.validator.invalid("indices",f)}return e.checks.push(function(r){for(var t=new FieldVal(r),i=0;i<r.length;i++){var n=e.rule_for_index(i);n.validate_as_field(i,t)}var a=t.end();return a}),e.validator.end()},"undefined"!=typeof module&&(module.exports=ArrayRuleField),"function"==typeof require&&(extend=require("extend"),BasicRuleField=require("./BasicRuleField")),extend(ChoiceRuleField,BasicRuleField),ChoiceRuleField.prototype.create_ui=function(e){var r=this;return r.json.choices=r.choices,r.ui_field=new ChoiceField(r.display_name||r.name,r.json),r.element=r.ui_field.element,e.add_field(r.name,r),r.ui_field},ChoiceRuleField.prototype.init=function(){var e=this;return e.allow_empty=e.validator.get("allow_empty",BasicVal.boolean(!1)),e.empty_message=e.validator.get("empty_message",BasicVal.string(!1)),e.choices=e.validator.get("choices",BasicVal.array(!0)),void 0!==e.choices&&e.checks.push(BasicVal.one_of(e.choices,{stop_on_error:!1})),e.validator.end()},"undefined"!=typeof module&&(module.exports=ChoiceRuleField),"function"==typeof require&&(extend=require("extend"),BasicRuleField=require("./BasicRuleField")),extend(BooleanRuleField,BasicRuleField),BooleanRuleField.prototype.create_ui=function(e){var r=this;return r.ui_field=new BooleanField(r.display_name||r.name,r.json),r.element=r.ui_field.element,e.add_field(r.name,r),r.ui_field},BooleanRuleField.prototype.init=function(){var e=this;return e.checks.push(BasicVal.boolean(e.required)),e.equal_to=e.validator.get("equal_to",BasicVal.boolean(!1)),void 0!==e.equal_to&&e.checks.push(BasicVal.equal_to(e.equal_to)),e.validator.end()},"undefined"!=typeof module&&(module.exports=BooleanRuleField),"function"==typeof require&&(extend=require("extend"),BasicRuleField=require("./BasicRuleField")),extend(EmailRuleField,BasicRuleField),EmailRuleField.prototype.create_ui=function(e){var r=this;return r.ui_field=new TextField(r.display_name||r.name,r.json),r.element=r.ui_field.element,e.add_field(r.name,r),r.ui_field},EmailRuleField.prototype.init=function(){var e=this;return e.checks.push(BasicVal.string(e.required),BasicVal.email()),e.validator.end()},"undefined"!=typeof module&&(module.exports=EmailRuleField),"function"==typeof require&&(FieldVal=require("fieldval"),BasicVal=require("fieldval-basicval"),RuleField=require("./fields/RuleField")),ValidationRule.errors={interval_conflict:function(e,r){return{error:501,error_message:"Only one interval can be used.",interval:e,existing:r}},invalid_indices_format:function(){return{error:502,error_message:"Invalid format for an indices rule."}}},ValidationRule.RuleField=RuleField,ValidationRule.prototype.init=function(e,r){var t=this,i=RuleField.create_field(e,r);return i[0]?i[0]:(t.field=i[1],null)},ValidationRule.prototype.create_form=function(){var e=this;if(FVForm){var r=new FVForm;return e.field.create_ui(r,r),r}},ValidationRule.prototype.validate=function(e){var r=this,t=r.field.validate(e);return t},"undefined"!=typeof module&&(module.exports=ValidationRule),RuleField.add_field_type({name:"text",display_name:"Text","class":"undefined"!=typeof TextRuleField?TextRuleField:require("./fields/TextRuleField")}),RuleField.add_field_type({name:"string",display_name:"String","class":"undefined"!=typeof TextRuleField?TextRuleField:require("./fields/TextRuleField")}),RuleField.add_field_type({name:"boolean",display_name:"Boolean","class":"undefined"!=typeof BooleanRuleField?BooleanRuleField:require("./fields/BooleanRuleField")}),RuleField.add_field_type({name:"number",display_name:"Number","class":"undefined"!=typeof NumberRuleField?NumberRuleField:require("./fields/NumberRuleField")}),RuleField.add_field_type({name:"object",display_name:"Object","class":"undefined"!=typeof ObjectRuleField?ObjectRuleField:require("./fields/ObjectRuleField")}),RuleField.add_field_type({name:"array",display_name:"Array","class":"undefined"!=typeof ArrayRuleField?ArrayRuleField:require("./fields/ArrayRuleField")}),RuleField.add_field_type({name:"choice",display_name:"Choice","class":"undefined"!=typeof ChoiceRuleField?ChoiceRuleField:require("./fields/ChoiceRuleField")}),RuleField.add_field_type({name:"email",display_name:"Email","class":"undefined"!=typeof EmailRuleField?EmailRuleField:require("./fields/EmailRuleField")}),FVForm.button_event="click",FVForm.prototype.init=function(){var e=this;for(var r in e.fields){var t=e.fields[r];t.init()}},FVForm.prototype.remove=function(){var e=this;for(var r in e.fields){var t=e.fields[r];t.remove()}},FVForm.prototype.blur=function(){var e=this;for(var r in e.fields){var t=e.fields[r];t.blur()}return e},FVForm.prototype.edit_mode=function(){var e=this;for(var r in e.fields)e.fields[r].edit_mode();return e},FVForm.prototype.view_mode=function(){var e=this;for(var r in e.fields)e.fields[r].view_mode();return e},FVForm.prototype.on_submit=function(e){var r=this;return r.submit_callbacks.push(e),r},FVForm.prototype.submit=function(){for(var e=this,r=e.val(),t=0;t<e.submit_callbacks.length;t++){var i=e.submit_callbacks[t];i(r)}return r},FVForm.prototype.add_field=function(e,r){var t=this;return r.element.appendTo(t.fields_element),t.fields[e]=r,t},FVForm.prototype.remove_field=function(e){var r=this,t=r.fields[e];t&&(t.remove(),delete r.fields[e])},FVForm.prototype.clear_errors=function(){var e=this;e.error(null)},FVForm.prototype.fields_error=function(e){var r=this;if(e){var t=e.invalid||{},i=e.missing||{},n=e.unrecognized||{};for(var a in r.fields){var o=r.fields[a],l=t[a]||i[a]||n[a]||null;o.error(l)}}else for(var a in r.fields){var o=r.fields[a];o.error(null)}},FVForm.prototype.show_error=function(){var e=this;e.error_message.show()},FVForm.prototype.hide_error=function(){var e=this;e.error_message.hide()},FVForm.prototype.error=function(e){var r=this;if(r.error_message.empty(),e){if(void 0===e.error)return void console.error("No error provided");if(0===e.error)r.fields_error(e),r.hide_error();else{if(4===e.error){for(var t=$("<ul />"),i=0;i<e.errors.length;i++){var n=e.errors[i];0===n.error?r.fields_error(n):t.append($("<li />").text(n.error_message))}r.error_message.append(t)}else r.error_message.append($("<span />").text(e.error_message));r.show_error()}}else r.fields_error(null),r.hide_error()},FVForm.prototype.disable=function(){var e=this;for(var r in e.fields){var t=e.fields[r];t.disable()}},FVForm.prototype.enable=function(){var e=this;for(var r in e.fields){var t=e.fields[r];t.enable()}},FVForm.prototype.val=function(e){var r=this;if(0===arguments.length){var t={};for(var i in r.fields){var n=r.fields[i];if(n.show_on_form_flag!==!1){var a=n.val();null!=a&&(t[i]=a)}}return t}if(e)for(var i in r.fields){var n=r.fields[i];n.val(e[i])}return r},Field.prototype.in_array=function(e){var r=this;r.is_in_array=!0,r.element.addClass("fv_nested").append(r.move_handle=$("<div />").addClass("fv_field_move_handle").html("&#8645;"),r.remove_button=$("<button />").addClass("fv_field_remove_button").html("&#10060;").on(FVForm.button_event,function(t){t.preventDefault(),e(),r.remove()}))},Field.prototype.init=function(){},Field.prototype.remove=function(){var e=this;e.element.remove()},Field.prototype.view_mode=function(){var e=this;e.is_in_array&&(e.remove_button.hide(),e.move_handle.hide()),e.element.addClass("fv_view_mode"),e.element.removeClass("fv_edit_mode"),console.log("view_mode ",e)},Field.prototype.edit_mode=function(){var e=this;e.is_in_array&&(e.remove_button.show(),e.move_handle.show()),e.element.addClass("fv_edit_mode"),e.element.removeClass("fv_view_mode"),console.log("edit_mode ",e)},Field.prototype.change_name=function(e){var r=this;return r.name=e,r},Field.prototype.layout=function(){var e=this;e.element.append(e.title,e.description_label,e.input_holder,e.error_message)},Field.prototype.on_change=function(e){var r=this;return r.on_change_callbacks.push(e),r},Field.prototype.hide_on_form=function(){var e=this;return e.show_on_form_flag=!1,e},Field.prototype.show_on_form=function(){var e=this;return e.show_on_form_flag=!0,e},Field.prototype.did_change=function(){for(var e=this,r=e.val(),t=0;t<e.on_change_callbacks.length;t++){var i=e.on_change_callbacks[t];i(r)}return e},Field.prototype.icon=function(){},Field.prototype.val=function(){console.error("Did not override Field.val()")},Field.prototype.disable=function(){},Field.prototype.enable=function(){},Field.prototype.blur=function(){},Field.prototype.focus=function(){},Field.prototype.show_error=function(){var e=this;e.error_message.show()},Field.prototype.hide_error=function(){var e=this;e.error_message.hide()},Field.prototype.error=function(e){var r=this;if(e){if(r.error_message.empty(),4===e.error){for(var t=$("<ul />"),i=0;i<e.errors.length;i++){var n=e.errors[i];t.append($("<li />").text(n.error_message))}r.error_message.append(t)}else r.error_message.append($("<span />").text(e.error_message));r.element&&r.element.addClass("fv_field_error"),r.show_error()}else r.hide_error(),r.element&&r.element.removeClass("fv_field_error")},fieldval_ui_extend(TextField,Field),TextField.prototype.on_enter=function(e){var r=this;return r.enter_callbacks.push(e),r},TextField.prototype.view_mode=function(){var e=this;e.input.prop({readonly:"readonly",disabled:"disabled"}),Field.prototype.view_mode.call(this)},TextField.prototype.edit_mode=function(){var e=this;e.input.prop({readonly:null,disabled:null}),Field.prototype.edit_mode.call(this)},TextField.prototype.icon=function(e){var r=this,t={"background-image":"url("+e.background+")","background-position":e.position,"background-repeat":"no-repeat","padding-left":e.width+"px"};return r.input.css(t),r},TextField.prototype.change_name=function(e){var r=this;return TextField.superClass.change_name.call(this,e),r.input.attr("placeholder",e),r},TextField.prototype.disable=function(){var e=this;return e.input.attr("disabled","disabled"),e},TextField.prototype.enable=function(){var e=this;return e.input.attr("disabled",null),e},TextField.prototype.focus=function(){var e=this;return e.input.focus(),e},TextField.prototype.blur=function(){var e=this;return e.input.blur(),e},TextField.numeric_regex=/^\d+(\.\d+)?$/,TextField.prototype.val=function(e){var r=this;if(0===arguments.length){var t=r.input.val();return"number"===r.input_type&&TextField.numeric_regex.test(t)?parseFloat(t):0===t.length?null:t}return r.input.val(e),r},fieldval_ui_extend(PasswordField,TextField),fieldval_ui_extend(DisplayField,Field),DisplayField.prototype.icon=function(e){var r=this,t={"background-image":"url("+e.background+")","background-position":e.position,"background-repeat":"no-repeat","padding-left":e.width+"px"};return r.input.css(t),r},DisplayField.prototype.change_name=function(e){var r=this;return DisplayField.superClass.change_name.call(this,e),r},DisplayField.replace_line_breaks=function(e){if("string"!=typeof e)return e;for(var r=[],t=e.split(/\n/),i=jQuery(document.createElement("div")),n=0;n<t.length;n++)r.push(i.text(t[n]).html());return r.join("<br>")},DisplayField.prototype.val=function(e){var r=this;return 0===arguments.length?r.input.text():(r.input.html(DisplayField.replace_line_breaks(e)),r)},fieldval_ui_extend(ChoiceField,Field),ChoiceField.prototype.disable=function(){var e=this;return e.select.attr("disabled","disabled"),e},ChoiceField.prototype.enable=function(){var e=this;return e.select.attr("disabled",null),e},ChoiceField.prototype.focus=function(){var e=this;return e.select.focus(),e},ChoiceField.prototype.blur=function(){var e=this;return e.select.blur(),e},ChoiceField.prototype.val=function(e){var r=this;if(0===arguments.length){var t=r.select.find(":selected"),i=t.index()-(r.allow_empty?1:0);return r.allow_empty&&-1===i?null:r.choice_values[i]}return r.select.val(void 0!==e?e:r.allow_empty?r.empty_option:r.choice_values[0]),r},fieldval_ui_extend(DateField,Field),DateField.prototype.add_element_from_component=function(e,r){var t=this;if(0===r){var i=e;t.inputs.push(null),t.input_holder.append($("<div />").addClass("fv_date_separator").text(i))}else{var n=r[r.length-1],a=$("<input />").attr({placeholder:e,size:n,maxlength:n}).addClass("fv_date_input").on("keyup",function(){t.did_change()});a.blur(function(){var e=a.val(),t=DateVal.pad_to_valid(e,r);a.val(t)}),t.inputs.push(a),t.input_holder.append(a)}},DateField.prototype.icon=function(){var e=this;return e},DateField.prototype.change_name=function(e){var r=this;return DateField.superClass.change_name.call(this,e),r.input.attr("placeholder",e),r},DateField.prototype.disable=function(){for(var e=this,r=0;r<e.inputs;r++){var t=e.inputs[r];t&&t.attr("disabled","disabled")}return e},DateField.prototype.enable=function(){for(var e=this,r=0;r<e.inputs;r++){var t=e.inputs[r];t&&t.attr("disabled",null)}return e},DateField.prototype.focus=function(){var e=this,r=e.inputs[0];return r&&r.blur(),e},DateField.prototype.blur=function(){for(var e=this,r=0;r<e.inputs;r++){var t=e.inputs[r];t&&t.blur()}return e},DateField.prototype.val=function(e){var r=this;if(0===arguments.length){for(var t="",i=0;i<r.format_array.length;i++){var n=r.format_array[i],a=DateVal.date_components[n];if(0===a)t+=n;else{var o=r.inputs[i],l=o.val().toString();t+=DateVal.pad_to_valid(l,a)}}return t}if(null!=e){"number"==typeof e?e=DateVal.date_with_format_array(new Date(e),r.format_array):e instanceof Date&&(e=DateVal.date_with_format_array(e,r.format_array));var s=DateVal.date(r.format_string,{emit:DateVal.EMIT_COMPONENT_ARRAY}).check(e,function(e){as_components=e});if(s)return void console.error("Invalid format passed to .val of DateField");for(var i=0;i<r.format_array.length;i++){var n=r.format_array[i],a=DateVal.date_components[n];if(0===a)t+=n;else{var o=r.inputs[i];o.val(as_components[i])}}}return r},fieldval_ui_extend(BooleanField,Field),BooleanField.prototype.disable=function(){var e=this;return e.input.attr("disabled","disabled"),e},BooleanField.prototype.enable=function(){var e=this;return e.input.attr("disabled",null),e},BooleanField.prototype.focus=function(){var e=this;return e.input.focus(),e},BooleanField.prototype.blur=function(){var e=this;return e.input.blur(),e},BooleanField.prototype.val=function(e){var r=this;return 0===arguments.length?r.input.is(":checked"):("true"===e?e=!0:"false"===e&&(e=!1),r.input.prop("checked",e),r)},fieldval_ui_extend(ObjectField,Field),ObjectField.prototype.init=function(){FVForm.prototype.init.call(this)},ObjectField.prototype.remove=function(){FVForm.prototype.remove.call(this),Field.prototype.remove.call(this)},ObjectField.prototype.add_field=function(e,r){FVForm.prototype.add_field.call(this,e,r)},ObjectField.prototype.change_name=function(e){var r=this;return ObjectField.superClass.change_name.call(this,e),r},ObjectField.prototype.view_mode=function(){var e=this;for(var r in e.fields)e.fields[r].view_mode();Field.prototype.view_mode.call(this)},ObjectField.prototype.edit_mode=function(){var e=this;for(var r in e.fields)e.fields[r].edit_mode();Field.prototype.edit_mode.call(this)},ObjectField.prototype.disable=function(){var e=this;return e},ObjectField.prototype.enable=function(){var e=this;return e},ObjectField.prototype.focus=function(){var e=this;return e},ObjectField.prototype.blur=function(){FVForm.prototype.blur.call(this)},ObjectField.prototype.error=function(e){ObjectField.superClass.error.call(this,e),FVForm.prototype.error.call(this,e)},ObjectField.prototype.fields_error=function(e){FVForm.prototype.fields_error.call(this,e)},ObjectField.prototype.clear_errors=function(){FVForm.prototype.clear_errors.call(this)},ObjectField.prototype.val=function(e){var r=this;if(0===arguments.length){var t={};for(var i in r.fields){var n=r.fields[i];t[i]=n.val()}return t}for(var i in e){var n=r.fields[i];n&&n.val(e[i])}return r},function(e,r,t,i){function n(r,i){this.w=e(t),this.el=e(r),this.options=e.extend({},l,i),this.init()}var a="ontouchstart"in t,o=function(){var e=t.createElement("div"),i=t.documentElement;if(!("pointerEvents"in e.style))return!1;e.style.pointerEvents="auto",e.style.pointerEvents="x",i.appendChild(e);var n=r.getComputedStyle&&"auto"===r.getComputedStyle(e,"").pointerEvents;return i.removeChild(e),!!n}(),l={listNodeName:"ol",itemNodeName:"li",rootClass:"dd",listClass:"dd-list",itemClass:"dd-item",dragClass:"dd-dragel",handleClass:"dd-handle",collapsedClass:"dd-collapsed",placeClass:"dd-placeholder",noDragClass:"dd-nodrag",emptyClass:"dd-empty",expandBtnHTML:'<button data-action="expand" type="button">Expand</button>',collapseBtnHTML:'<button data-action="collapse" type="button">Collapse</button>',group:0,maxDepth:5,threshold:20};n.prototype={init:function(){var t=this;t.reset(),t.el.data("nestable-group",this.options.group),t.placeEl=e('<div class="'+t.options.placeClass+'"/>'),e.each(this.el.find(t.options.itemNodeName),function(r,i){t.setParent(e(i))}),t.el.on("click","button",function(r){if(!t.dragEl){var i=e(r.currentTarget),n=i.data("action"),a=i.parent(t.options.itemNodeName);"collapse"===n&&t.collapseItem(a),"expand"===n&&t.expandItem(a)}});var i=function(r){var i=e(r.target);if(!i.hasClass(t.options.handleClass)){if(i.closest("."+t.options.noDragClass).length)return;i=i.closest("."+t.options.handleClass)}i.length&&!t.dragEl&&(t.isTouch=/^touch/.test(r.type),t.isTouch&&1!==r.touches.length||(r.preventDefault(),t.dragStart(r.touches?r.touches[0]:r)))},n=function(e){t.dragEl&&(e.preventDefault(),t.dragMove(e.touches?e.touches[0]:e))},o=function(e){t.dragEl&&(e.preventDefault(),t.dragStop(e.touches?e.touches[0]:e))};a&&(t.el[0].addEventListener("touchstart",i,!1),r.addEventListener("touchmove",n,!1),r.addEventListener("touchend",o,!1),r.addEventListener("touchcancel",o,!1)),t.el.on("mousedown",i),t.w.on("mousemove",n),t.w.on("mouseup",o)},serialize:function(){var r,t=0,i=this;return step=function(r,t){var n=[],a=r.children(i.options.itemNodeName);return a.each(function(){var r=e(this),a=e.extend({},r.data()),o=r.children(i.options.listNodeName);o.length&&(a.children=step(o,t+1)),n.push(a)}),n},r=step(i.el.find(i.options.listNodeName).first(),t)},serialise:function(){return this.serialize()},reset:function(){this.mouse={offsetX:0,offsetY:0,startX:0,startY:0,lastX:0,lastY:0,nowX:0,nowY:0,distX:0,distY:0,dirAx:0,dirX:0,dirY:0,lastDirX:0,lastDirY:0,distAxX:0,distAxY:0},this.isTouch=!1,this.moving=!1,this.dragEl=null,this.dragRootEl=null,this.dragDepth=0,this.hasNewRoot=!1,this.pointEl=null},expandItem:function(e){e.removeClass(this.options.collapsedClass),e.children('[data-action="expand"]').hide(),e.children('[data-action="collapse"]').show(),e.children(this.options.listNodeName).show()},collapseItem:function(e){var r=e.children(this.options.listNodeName);r.length&&(e.addClass(this.options.collapsedClass),e.children('[data-action="collapse"]').hide(),e.children('[data-action="expand"]').show(),e.children(this.options.listNodeName).hide())},expandAll:function(){var r=this;r.el.find(r.options.itemNodeName).each(function(){r.expandItem(e(this))})},collapseAll:function(){var r=this;r.el.find(r.options.itemNodeName).each(function(){r.collapseItem(e(this))})},setParent:function(r){r.children(this.options.listNodeName).length&&(r.prepend(e(this.options.expandBtnHTML)),r.prepend(e(this.options.collapseBtnHTML))),r.children('[data-action="expand"]').hide()},unsetParent:function(e){e.removeClass(this.options.collapsedClass),e.children("[data-action]").remove(),e.children(this.options.listNodeName).remove()},dragStart:function(r){var n=this.mouse,a=e(r.target),o=a.closest(this.options.itemNodeName);this.placeEl.css("height",o.height()),this.placeEl.css("width",o.width()),this.placeEl.css("display",o.css("display")),n.offsetX=r.offsetX!==i?r.offsetX:r.pageX-a.offset().left,n.offsetY=r.offsetY!==i?r.offsetY:r.pageY-a.offset().top,n.startX=n.lastX=r.pageX,n.startY=n.lastY=r.pageY,this.dragRootEl=this.el,this.el_offset=this.el.offset(),this.dragEl=e(t.createElement(this.options.listNodeName)).addClass(this.options.listClass+" "+this.options.dragClass),this.dragEl.css("width",o.width()),o.after(this.placeEl),o[0].parentNode.removeChild(o[0]),o.appendTo(this.dragEl),e(this.el).append(this.dragEl),this.dragEl.css({left:r.pageX-n.offsetX-this.el_offset.left,top:r.pageY-n.offsetY-this.el_offset.top});var l,s,d=this.dragEl.find(this.options.itemNodeName);for(l=0;l<d.length;l++)s=e(d[l]).parents(this.options.listNodeName).length,s>this.dragDepth&&(this.dragDepth=s)},dragStop:function(){var e=this.dragEl.children(this.options.itemNodeName).first();e[0].parentNode.removeChild(e[0]),this.placeEl.replaceWith(e),this.dragEl.remove(),this.el.trigger("change"),this.hasNewRoot&&this.dragRootEl.trigger("change"),this.reset()},dragMove:function(i){var n,a,l,s,d,u=this.options,c=this.mouse;this.dragEl.css({left:i.pageX-c.offsetX-this.el_offset.left,top:i.pageY-c.offsetY-this.el_offset.top}),c.lastX=c.nowX,c.lastY=c.nowY,c.nowX=i.pageX,c.nowY=i.pageY,c.distX=c.nowX-c.lastX,c.distY=c.nowY-c.lastY,c.lastDirX=c.dirX,c.lastDirY=c.dirY,c.dirX=0===c.distX?0:c.distX>0?1:-1,c.dirY=0===c.distY?0:c.distY>0?1:-1;var f=Math.abs(c.distX)>Math.abs(c.distY)?1:0;if(!c.moving)return c.dirAx=f,void(c.moving=!0);c.dirAx!==f?(c.distAxX=0,c.distAxY=0):(c.distAxX+=Math.abs(c.distX),0!==c.dirX&&c.dirX!==c.lastDirX&&(c.distAxX=0),c.distAxY+=Math.abs(c.distY),0!==c.dirY&&c.dirY!==c.lastDirY&&(c.distAxY=0)),c.dirAx=f,c.dirAx&&c.distAxX>=u.threshold&&(c.distAxX=0,l=this.placeEl.prev(u.itemNodeName),c.distX>0&&l.length&&!l.hasClass(u.collapsedClass)&&(n=l.find(u.listNodeName).last(),d=this.placeEl.parents(u.listNodeName).length,d+this.dragDepth<=u.maxDepth&&(n.length?(n=l.children(u.listNodeName).last(),n.append(this.placeEl)):(n=e("<"+u.listNodeName+"/>").addClass(u.listClass),n.append(this.placeEl),l.append(n),this.setParent(l)))),c.distX<0&&(s=this.placeEl.next(u.itemNodeName),s.length||(a=this.placeEl.parent(),this.placeEl.closest(u.itemNodeName).after(this.placeEl),a.children().length||this.unsetParent(a.parent()))));var p=!1;if(o||(this.dragEl[0].style.visibility="hidden"),this.pointEl=e(t.elementFromPoint(i.pageX-t.body.scrollLeft,i.pageY-(r.pageYOffset||t.documentElement.scrollTop))),o||(this.dragEl[0].style.visibility="visible"),this.pointEl.hasClass(u.handleClass)&&(this.pointEl=this.pointEl.closest("."+u.itemClass)),this.pointEl.hasClass(u.emptyClass))p=!0;else if(!this.pointEl.length||!this.pointEl.hasClass(u.itemClass))return;var _=this.pointEl.closest("."+u.rootClass),h=this.dragRootEl.data("nestable-id")!==_.data("nestable-id");if(!c.dirAx||h||p){if(h&&u.group!==_.data("nestable-group"))return;if(d=this.dragDepth-1+this.pointEl.parents(u.listNodeName).length,d>u.maxDepth)return;var v=i.pageY<this.pointEl.offset().top+this.pointEl.height()/2;a=this.placeEl.parent(),p?(n=e(t.createElement(u.listNodeName)).addClass(u.listClass),n.append(this.placeEl),this.pointEl.replaceWith(n)):v?this.pointEl.before(this.placeEl):this.pointEl.after(this.placeEl),a.children().length||this.unsetParent(a.parent()),this.dragRootEl.find(u.itemNodeName).length||this.dragRootEl.append('<div class="'+u.emptyClass+'"/>'),h&&(this.dragRootEl=_,this.hasNewRoot=this.el[0]!==this.dragRootEl[0])}}},e.fn.nestable=function(r){var t=this,i=this;return t.each(function(){var t=e(this).data("nestable");t?"string"==typeof r&&"function"==typeof t[r]&&(i=t[r]()):(e(this).data("nestable",new n(this,r)),e(this).data("nestable-id",(new Date).getTime()))}),i||t}}(window.jQuery||window.Zepto,window,document),fieldval_ui_extend(ArrayField,Field),ArrayField.prototype.reorder=function(){var e=this;e.fields=[];for(var r=e.fields_element.children(),t=0;t<r.length;t++){var i=$(r[t]),n=i.data("field");e.fields.push(n)}},ArrayField.prototype.create_add_field_button=function(){var e=this,r=$("<button />").addClass("fv_add_field_button").text("+").on(FVForm.button_event,function(r){r.preventDefault(),e.new_field(e.fields.length)});return e.add_field_buttons.push(r),r},ArrayField.prototype.new_field=function(){throw new Error("ArrayField.new_field must be overriden to create fields")},ArrayField.prototype.add_field=function(e,r){var t=this;r.in_array(function(){t.remove_field(r)}),r.element.appendTo(t.fields_element),t.fields.push(r),t.input_holder.nestable("init")},ArrayField.prototype.remove_field=function(e){for(var r=this,t=0;t<r.fields.length;t++)r.fields[t]===e&&r.fields.splice(t,1)},ArrayField.prototype.view_mode=function(){var e=this;for(var r in e.fields)e.fields[r].view_mode();for(var r=0;r<e.add_field_buttons.length;r++){var t=e.add_field_buttons[r];t.hide()}},ArrayField.prototype.edit_mode=function(){var e=this;for(var r in e.fields)e.fields[r].edit_mode();for(var r=0;r<e.add_field_buttons.length;r++){var t=e.add_field_buttons[r];t.show()}},ArrayField.prototype.error=function(e){ArrayField.superClass.error.call(this,e)},ArrayField.prototype.fields_error=function(e){var r=this;if(e)for(var t=e.invalid||{},i=e.missing||{},n=e.unrecognized||{},a=0;a<r.fields.length;a++){var o=r.fields[a],l=t[a]||i[a]||n[a]||null;o.error(l)}else for(var a in r.fields){var o=r.fields[a];o.error(null)}},ArrayField.prototype.clear_errors=function(){},ArrayField.prototype.error=function(e){var r=this;if(r.error_message.empty(),e){if(void 0===e.error)return void console.error("No error provided");if(0===e.error)r.fields_error(e),r.hide_error();else{if(4===e.error){for(var t=$("<ul />"),i=0;i<e.errors.length;i++){var n=e.errors[i];0===n.error?r.fields_error(n):t.append($("<li />").text(n.error_message))}r.error_message.append(t)}else r.error_message.append($("<span />").text(e.error_message));r.show_error()}}else r.fields_error(null),r.hide_error()},ArrayField.prototype.val=function(e){var r=this;if(0===arguments.length){for(var t=[],i=0;i<r.fields.length;i++){var n=r.fields[i],a=n.val();t.push(a)}return t}if(e)for(var i=0;i<e.length;i++){var n=r.fields[i];n||(n=r.new_field(i)),n.val(e[i])}return r},"undefined"!=typeof module&&(module.exports={fieldval:FieldVal,basicval:BasicVal,dateval:DateVal,rules:ValidationRule});