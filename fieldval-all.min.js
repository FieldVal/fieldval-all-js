function fieldval_rules_extend(e,r){function t(){}t.prototype=r.prototype,e.prototype=new t,e.prototype.constructor=e,e.superConstructor=r,e.superClass=r.prototype}function TextRuleField(e,r){TextRuleField.superConstructor.call(this,e,r)}function NumberRuleField(e,r){NumberRuleField.superConstructor.call(this,e,r)}function ObjectRuleField(e,r){ObjectRuleField.superConstructor.call(this,e,r)}function ChoiceRuleField(e,r){ChoiceRuleField.superConstructor.call(this,e,r)}function RuleField(e,r){var t=this;if(t.json=e,t.checks=[],t.validator="undefined"!=typeof r?r:new FieldVal(e),t.name=t.validator.get("name",BasicVal.string(!1)),t.display_name=t.validator.get("display_name",BasicVal.string(!1)),t.description=t.validator.get("description",BasicVal.string(!1)),t.type=t.validator.get("type",BasicVal.string(!0)),t.required=t.validator.default(!0).get("required",BasicVal.boolean(!1)),null!=e){var i=t.validator.get("exists",BasicVal.boolean(!1));null!=i&&(existsFilter=i?1:2)}}function ValidationRule(){}function fieldval_ui_extend(e,r){function t(){}t.prototype=r.prototype,e.prototype=new t,e.prototype.constructor=e,e.superConstructor=r,e.superClass=r.prototype}function FVForm(e){var r=this;r.element=$("<form />").addClass("fieldval_ui_form").append(r.error_message=$("<div />").addClass("error_message").hide()).on("submit",function(e){e.preventDefault(),r.submit()}),r.fields=e||{},r.fields_element=r.element,r.submit_callbacks=[]}function Field(e){var r=this;r.name=e,r.show_on_form_flag=!0,r.on_change_callbacks=[],r.container=$("<div />").addClass("field_container"),r.element=$("<div />").addClass("field"),r.title=$("<div />").addClass("field_title").text(r.name),r.input_holder=$("<div />").addClass("input_holder"),r.error_message=$("<div />").addClass("error_message").hide(),r.layout()}function TextField(e,r){var t=this,i=typeof r;"string"===i?(t.input_type=r,r={}):"object"===i?t.input_type=r.input_type||"text":r={},t.options=r,TextField.superConstructor.call(this,e),t.element.addClass("text_field"),t.input=$("textarea"===t.input_type?"<textarea />":"text"===t.input_type||"number"===t.input_type?"<input type='text' />":"<input type='"+t.input_type+"' />"),t.input.addClass("text_input").attr("placeholder",e).on("keyup",function(){t.did_change()}).appendTo(t.input_holder)}function PasswordField(e){PasswordField.superConstructor.call(this,e,"password")}function DisplayField(e){var r=this;DisplayField.superConstructor.call(this,e),r.element.addClass("display_field"),r.input=$("<div />").appendTo(r.input_holder),r.hide_on_form()}function ChoiceField(e,r){var t=this;if(ChoiceField.superConstructor.call(this,e,r),t.properties=r,t.choices=t.properties.choices||[],t.allow_empty=t.properties.allow_empty||!1,t.element.addClass("choice_field"),t.select=$("<select/>").addClass("choice_input").on("change",function(){t.did_change()}).appendTo(t.input_holder),t.choice_values=[],t.allow_empty){var i=$("<option />").attr("value",null).text("");t.select.append(i)}for(var n=0;n<t.choices.length;n++){var o,a,l=t.choices[n];"object"==typeof l?(o=l[0],a=l[1]):o=a=l,t.choice_values.push(o);var i=$("<option />").attr("value",o).text(a);t.select.append(i)}}function DateField(e,r){var t=this;t.format=r,DateField.superConstructor.call(this,e),t.element.addClass("date_field"),t.input_holder.append(t.day_input=$("<input type='number' />").addClass("day_input date_input").attr("placeholder","DD").on("keyup",function(){t.did_change()}),t.month_input=$("<input type='number' />").addClass("month_input date_input").attr("placeholder","MM").on("keyup",function(){t.did_change()}),t.year_input=$("<input type='number' />").addClass("year_input date_input").attr("placeholder","YYYY").on("keyup",function(){t.did_change()}))}function BooleanField(e){var r=this;BooleanField.superConstructor.call(this,e),r.element.addClass("choice_field"),r.input=$("<input type='checkbox' />").addClass("boolean_input").on("change",function(){r.did_change()}).appendTo(r.input_holder)}function ObjectField(e){var r=this;ObjectField.superConstructor.call(this,e),r.element.addClass("object_field"),r.fields_element=r.input_holder,r.fields={}}var logger;"function"==typeof require&&(logger=require("tracer").console()),FieldVal=function(e){var r=this;r.validating=e,r.missing_keys={},r.missing_count=0,r.invalid_keys={},r.invalid_count=0,r.unrecognized_keys={},r.unrecognized_count=0,r.recognized_keys={},r.errors=[]},FieldVal.INCORRECT_TYPE_ERROR=function(e,r){return{error_message:"Incorrect field type. Expected "+e+".",error:FieldVal.INCORRECT_FIELD_TYPE,expected:e,received:r}},FieldVal.MISSING_ERROR=function(){return{error_message:"Field missing.",error:FieldVal.FIELD_MISSING}},FieldVal.REQUIRED_ERROR="required",FieldVal.NOT_REQUIRED_BUT_MISSING="notrequired",FieldVal.ONE_OR_MORE_ERRORS=0,FieldVal.FIELD_MISSING=1,FieldVal.INCORRECT_FIELD_TYPE=2,FieldVal.FIELD_UNRECOGNIZED=3,FieldVal.MULTIPLE_ERRORS=4,FieldVal.get_value_and_type=function(e,r,t){t||(t={});var i="undefined"!=typeof t.parse?t.parse:!1;if("string"!=typeof e||i)if("integer"==r){var n=parseInt(e);isNaN(n)||(""+n).length!=(""+e).length||(e=n,r=n,r="number")}else if("float"==r){var n=parseFloat(e);isNaN(n)||(e=n,r="number")}var o=typeof e;return"object"==o&&"[object Array]"===Object.prototype.toString.call(e)&&(o="array"),{type:o,desired_type:r,value:e}},FieldVal.use_checks=function(e,r,t,i,n){var o,a=!1,l=!1;t||(o=new FieldVal);for(var s=!1,u=function(r){var n,d=!0,c={};if("object"==typeof r){if("[object Array]"===Object.prototype.toString.call(r)){for(var p=0;p<r.length&&(u(r[p]),!l);p++);return}if(0==r.length)return;c=r,n=c.check,null!=c&&void 0!==c.stop_on_error&&(d=c.stop_on_error)}else n=r,d=!0;var _=n(e,function(r){e=r});if(null!=_){if(_===FieldVal.REQUIRED_ERROR)if(i){if(!t)return _;t.missing(i,c)}else{if(!t)return void(s=!0);t.error(FieldVal.create_error(FieldVal.MISSING_ERROR,c))}else _===FieldVal.NOT_REQUIRED_BUT_MISSING||(t?i?t.invalid(i,_):t.error(_):o.error(_));a=!0,d&&(l=!0)}},d=0;d<r.length;d++){var c=r[d];if(u(c),s)return FieldVal.REQUIRED_ERROR;if(l)break}return a?n&&n(void 0):n&&n(e),t?void 0:o.end()},FieldVal.required=function(e,r){var t=function(r){return null==r?e||void 0===e?FieldVal.REQUIRED_ERROR:FieldVal.NOT_REQUIRED_BUT_MISSING:void 0};return void 0!==r?(r.check=t,r):t},FieldVal.type=function(e,r){var t=void 0!==r.required?r.required:!0,i=function(i,n){var o=FieldVal.required(t)(i);if(o)return o;var a=FieldVal.get_value_and_type(i,e,r),l=a.desired_type,s=a.type,i=a.value;return s!==l?FieldVal.create_error(FieldVal.INCORRECT_TYPE_ERROR,r,l,s):void(n&&n(i))};return void 0!==r?(r.check=i,r):i},FieldVal.prototype.default=function(e){var r=this;return{get:function(){var t=r.get.apply(r,arguments);return"undefined"!=typeof t?t:e}}},FieldVal.prototype.get=function(e){var r=this,t=r.validating[e];if(r.recognized_keys[e]=!0,arguments.length>1){var i=Array.prototype.slice.call(arguments,1);FieldVal.use_checks(t,i,r,e,function(e){t=e})}return t},FieldVal.prototype.error=function(e){var r=this;return r.errors.push(e),r},FieldVal.prototype.invalid=function(e,r){var t=this,i=t.invalid_keys[e];return null!=i?null!=i.errors?i.errors.push(r):t.invalid_keys[e]={error:FieldVal.MULTIPLE_ERRORS,error_message:"Multiple errors.",errors:[i,r]}:(t.invalid_keys[e]=r,t.invalid_count++),t},FieldVal.prototype.missing=function(e,r){var t=this;return t.missing_keys[e]=FieldVal.create_error(FieldVal.MISSING_ERROR,r),t.missing_count++,t},FieldVal.prototype.unrecognized=function(e){var r=this;return r.unrecognized_keys[e]={error_message:"Unrecognized field.",error:FieldVal.FIELD_UNRECOGNIZED},r.unrecognized_count++,r},FieldVal.prototype.recognized=function(e){var r=this;return r.recognized_keys[e]=!0,r},FieldVal.prototype.get_unrecognized=function(){var e=this,r=[];for(var t in e.validating)1!=e.recognized_keys[t]&&r.push(t);return r},FieldVal.prototype.end=function(){var e=this,r={},t=!1,i={},n=0;for(var o in e.unrecognized)i[o]=e.unrecognized[o],n++;for(var a=e.get_unrecognized(),l=0;l<a.length;l++){var o=a[l];i[o]||(i[o]={error_message:"Unrecognized field.",error:FieldVal.FIELD_UNRECOGNIZED},n++)}if(0!==e.missing_count&&(r.missing=e.missing_keys,t=!0),0!==e.invalid_count&&(r.invalid=e.invalid_keys,t=!0),0!==n&&(r.unrecognized=i,t=!0),t){if(r.error_message="One or more errors.",r.error=FieldVal.ONE_OR_MORE_ERRORS,0===e.errors.length)return r;e.errors.push(r)}return 0!==e.errors.length?1===e.errors.length?e.errors[0]:{error:FieldVal.MULTIPLE_ERRORS,error_message:"Multiple errors.",errors:e.errors}:null},FieldVal.create_error=function(e,r){if(!r)return e.apply(null,Array.prototype.slice.call(arguments,2));if(e===FieldVal.MISSING_ERROR){if("function"==typeof r.missing_error)return r.missing_error.apply(null,Array.prototype.slice.call(arguments,2));if("object"==typeof r.missing_error)return r.missing_error;if("string"==typeof r.missing_error)return{error_message:r.missing_error}}else{if("function"==typeof r.error)return r.error.apply(null,Array.prototype.slice.call(arguments,2));if("object"==typeof r.error)return r.error;if("string"==typeof r.error)return{error_message:r.error}}return e.apply(null,Array.prototype.slice.call(arguments,2))},FieldVal.Error=function(e,r,t){if("object"==typeof e&&"[object Array]"===Object.prototype.toString.call(e)){var i=e;e=i[0],r=i[1],t=i[2]}var n={error:e};return null!=r&&(n.error_message=r),null!=t&&(n.data=t),n},"undefined"!=typeof module&&(module.exports=FieldVal);var logger;"function"==typeof require&&(logger=require("tracer").console());var _validator_ref;_validator_ref="function"==typeof require?require("fieldval"):FieldVal;var BasicVal={errors:{too_short:function(e){return{error:100,error_message:"Length is less than "+e}},too_long:function(e){return{error:101,error_message:"Length is greater than "+e}},too_small:function(e){return{error:102,error_message:"Value is less than "+e}},too_large:function(e){return{error:103,error_message:"Value is greater than "+e}},not_in_list:function(){return{error:104,error_message:"Value is not a valid choice"}},cannot_be_empty:function(){return{error:105,error_message:"Value cannot be empty."}},no_prefix:function(e){return{error:106,error_message:"Value does not have prefix: "+e}},invalid_email:function(){return{error:107,error_message:"Invalid email address format."}},invalid_url:function(){return{error:108,error_message:"Invalid url format."}},incorrect_length:function(e){return{error:109,error_message:"Length is not equal to "+e}},no_suffix:function(e){return{error:110,error_message:"Value does not have suffix: "+e}}},merge_required_and_flags:function(e,r){return"object"==typeof e?r=e:(r||(r={}),r.required=e),r},integer:function(e,r){return _validator_ref.type("integer",BasicVal.merge_required_and_flags(e,r))},number:function(e,r){return _validator_ref.type("number",BasicVal.merge_required_and_flags(e,r))},array:function(e,r){return _validator_ref.type("array",BasicVal.merge_required_and_flags(e,r))},object:function(e,r){return _validator_ref.type("object",BasicVal.merge_required_and_flags(e,r))},"float":function(e,r){return _validator_ref.type("float",BasicVal.merge_required_and_flags(e,r))},"boolean":function(e,r){return _validator_ref.type("boolean",BasicVal.merge_required_and_flags(e,r))},string:function(e,r){r=BasicVal.merge_required_and_flags(e,r);var t=function(t,i){var n=_validator_ref.type("string",r);"object"==typeof n&&(n=n.check);var o=n(t,i);return o?o:(r&&r.trim===!1||(t=t.trim()),0===t.length?e||void 0===e?_validator_ref.REQUIRED_ERROR:_validator_ref.NOT_REQUIRED_BUT_MISSING:void 0)};return r?(r.check=t,r):t},length:function(e,r){var t=function(t){return t.length!==e?FieldVal.create_error(BasicVal.errors.incorrect_length,r,e):void 0};return r?(r.check=t,r):t},min_length:function(e,r){var t=function(t){return t.length<e?FieldVal.create_error(BasicVal.errors.too_short,r,e):void 0};return r?(r.check=t,r):t},max_length:function(e,r){var t=function(t){return t.length>e?FieldVal.create_error(BasicVal.errors.too_long,r,e):void 0};return r?(r.check=t,r):t},minimum:function(e,r){var t=function(t){return e>t?FieldVal.create_error(BasicVal.errors.too_small,r,e):void 0};return r?(r.check=t,r):t},maximum:function(e,r){var t=function(t){return t>e?FieldVal.create_error(BasicVal.errors.too_large,r,e):void 0};return r?(r.check=t,r):t},range:function(e,r,t){var i=function(i){return e>i?FieldVal.create_error(BasicVal.errors.too_small,t,e):i>r?FieldVal.create_error(BasicVal.errors.too_large,t,r):void 0};return t?(t.check=i,t):i},one_of:function(e,r){var t=[];if("[object Array]"===Object.prototype.toString.call(e))for(var i=0;i<e.length;i++){var n=e[i];t.push("object"==typeof n?n[0]:n)}else for(var i in e)t.push(i);var o=function(e){return-1===t.indexOf(e)?FieldVal.create_error(BasicVal.errors.not_in_list,r):void 0};return r?(r.check=o,r):o},not_empty:function(e,r){var t=function(t){if(e){if(0===t.trim().length)return FieldVal.create_error(BasicVal.errors.cannot_be_empty,r)}else if(0===t.length)return FieldVal.create_error(BasicVal.errors.cannot_be_empty,r)};return r?(r.check=t,r):t},prefix:function(e,r){var t=function(t){return t.length>=e.length?t.substring(0,e.length)!=e?FieldVal.create_error(BasicVal.errors.no_prefix,r,e):void 0:FieldVal.create_error(BasicVal.errors.no_prefix,r,e)};return r?(r.check=t,r):t},suffix:function(e,r){var t=function(t){return t.length>=e.length?t.substring(t.length-e.length,t.length)!=e?FieldVal.create_error(BasicVal.errors.no_suffix,r,e):void 0:FieldVal.create_error(BasicVal.errors.no_suffix,r,e)};return r?(r.check=t,r):t},each:function(e,r){var t=function(r){for(var t=new _validator_ref(null),i=0;i<r.length;i++){var n=r[i],o=e(n,i);null!=o&&t.invalid(""+i,o)}var a=t.end();return null!=a?a:void 0};return r?(r.check=t,r):t},email:function(e){var r=function(r){var t=BasicVal.email_regex;return t.test(r)?void 0:FieldVal.create_error(BasicVal.errors.invalid_email,e)};return e?(e.check=r,e):r},url:function(e){var r=function(r){var t=BasicVal.url_regex;return t.test(r)?void 0:FieldVal.create_error(BasicVal.errors.invalid_url,e)};return e?(e.check=r,e):r}};BasicVal.email_regex=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,BasicVal.url_regex=/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/,"undefined"!=typeof module&&(module.exports=BasicVal),"function"==typeof require&&(FieldVal=require("fieldval"),BasicVal=require("fieldval-basicval")),fieldval_rules_extend(TextRuleField,RuleField),TextRuleField.prototype.create_ui=function(e){var r=this;if(TextField){var t=new TextField(r.display_name||r.name,r.json);return e.add_field(r.name,t),t}},TextRuleField.prototype.init=function(){var e=this;return e.min_length=e.validator.get("min_length",BasicVal.integer(!1)),e.max_length=e.validator.get("max_length",BasicVal.integer(!1)),e.phrase=e.validator.get("phrase",BasicVal.string(!1)),e.equal_to=e.validator.get("equal_to",BasicVal.string(!1)),e.ci_equal_to=e.validator.get("ci_equal_to",BasicVal.string(!1)),e.prefix=e.validator.get("prefix",BasicVal.string(!1)),e.ci_prefix=e.validator.get("ci_prefix",BasicVal.string(!1)),e.query=e.validator.get("query",BasicVal.string(!1)),e.validator.end()},TextRuleField.prototype.create_checks=function(){var e=this;e.checks.push(BasicVal.string(e.required)),e.min_length&&e.checks.push(BasicVal.min_length(e.min_length,{stop_on_error:!1})),e.max_length&&e.checks.push(BasicVal.max_length(e.max_length,{stop_on_error:!1}))},fieldval_rules_extend(NumberRuleField,RuleField),NumberRuleField.prototype.create_ui=function(e){var r=this;if(TextField){var t=new TextField(r.display_name||r.name,r.json);return e.add_field(r.name,t),t}},NumberRuleField.prototype.init=function(){var e=this;return e.minimum=e.validator.get("minimum",BasicVal.number(!1)),null!=e.minimum,e.maximum=e.validator.get("maximum",BasicVal.number(!1)),null!=e.maximum,e.integer=e.validator.get("integer",BasicVal.boolean(!1)),e.validator.end()},NumberRuleField.prototype.create_checks=function(){var e=this;e.checks.push(BasicVal.number(e.required)),e.minimum&&e.checks.push(BasicVal.minimum(e.minimum,{stop_on_error:!1})),e.maximum&&e.checks.push(BasicVal.maximum(e.maximum,{stop_on_error:!1})),e.integer&&e.checks.push(BasicVal.integer(!1,{stop_on_error:!1}))},fieldval_rules_extend(ObjectRuleField,RuleField),ObjectRuleField.prototype.create_ui=function(e,r){var t=this;if(ObjectField){var i;i=r?r:new ObjectField(t.display_name||t.name,t.json);for(var n in t.fields){var o=t.fields[n];o.create_ui(i)}return r||e.add_field(t.name,i),i}},ObjectRuleField.prototype.init=function(){var e=this;e.fields={};var r=e.validator.get("fields",BasicVal.object(!1));if(null!=r){var t=new FieldVal(null);for(var i in r){var n=r[i];n.name||(n.name=i);var o=RuleField.create_field(n),a=o[0],l=o[1];null!=a&&t.invalid(i,a),e.fields[i]=l}var s=t.end();null!=s&&e.validator.invalid("fields",s)}return e.validator.end()},ObjectRuleField.prototype.create_checks=function(){var e=this;e.checks.push(BasicVal.object(e.required)),e.checks.push(function(r){var t=new FieldVal(r);for(var i in e.fields){var n=e.fields[i];n.validate_as_field(i,t)}var o=t.end();return o})},fieldval_rules_extend(ChoiceRuleField,RuleField),ChoiceRuleField.prototype.create_ui=function(e){var r=this;if(ChoiceField){var t=new ChoiceField(r.display_name||r.name,r.choices,r.json);return e.add_field(r.name,t),t}},ChoiceRuleField.prototype.init=function(){var e=this;return e.choices=e.validator.get("choices",BasicVal.array(!0)),e.validator.end()},ChoiceRuleField.prototype.create_checks=function(){var e=this;e.checks.push(FieldVal.required(!0)),e.choices&&e.checks.push(BasicVal.one_of(e.choices,{stop_on_error:!1}))},RuleField.types={text:TextRuleField,string:TextRuleField,number:NumberRuleField,object:ObjectRuleField,choice:ChoiceRuleField},RuleField.create_field=function(e){var r=null,t=new FieldVal(e),i=t.get("type",BasicVal.string(!0),BasicVal.one_of(RuleField.types));if(!i)return[t.end(),null];var n=RuleField.types[i];r=new n(e,t);var o=r.init();return null!=o?[o,null]:(r.create_checks(),[null,r])},RuleField.prototype.validate_as_field=function(e,r){var t=this,i=r.get(e,t.checks);return i},RuleField.prototype.validate=function(e){var r=this,t=new FieldVal(null),i=FieldVal.use_checks(e,r.checks);return i&&t.error(i),t.end()},ValidationRule.prototype.init=function(e){var r=this,t=RuleField.create_field(e);return t[0]?t[0]:void(r.field=t[1])},ValidationRule.prototype.create_form=function(){var e=this;if(Form){var r=new Form;return e.field.create_ui(r,r),r}},ValidationRule.prototype.validate=function(e){var r=this,t=r.field.validate(e);return t},"undefined"!=typeof module&&(module.exports=ValidationRule),FVForm.prototype.edit_mode=function(){var e=this;for(var r in e.fields)e.fields[r].edit_mode();return e},FVForm.prototype.view_mode=function(){var e=this;for(var r in e.fields)e.fields[r].view_mode();return e},FVForm.prototype.on_submit=function(e){var r=this;return r.submit_callbacks.push(e),r},FVForm.prototype.submit=function(){for(var e=this,r=e.val(),t=0;t<e.submit_callbacks.length;t++){var i=e.submit_callbacks[t];i(r)}return r},FVForm.prototype.add_field=function(e,r){var t=this;return r.container.appendTo(t.fields_element),t.fields[e]=r,t},FVForm.prototype.clear_errors=function(){var e=this;e.error(null)},FVForm.prototype.fields_error=function(e){var r=this;if(e){var t=e.invalid||{},i=e.missing||{},n=e.unrecognized||{};for(var o in r.fields){var a=r.fields[o],l=t[o]||i[o]||n[o]||null;a.error(l)}}else for(var o in r.fields){var a=r.fields[o];a.error(null)}},FVForm.prototype.show_error=function(){var e=this;e.error_message.show()},FVForm.prototype.hide_error=function(){var e=this;e.error_message.hide()},FVForm.prototype.error=function(e){var r=this;if(r.error_message.empty(),e){if(void 0===e.error)return void console.error("No error provided");if(0===e.error)r.fields_error(e),r.hide_error();else{if(4===e.error){for(var t=$("<ul />"),i=0;i<e.errors.length;i++){var n=e.errors[i];0===n.error?r.fields_error(n):t.append($("<li />").text(n.error_message))}r.error_message.append(t)}else r.error_message.append($("<span />").text(e.error_message));r.show_error()}}else r.fields_error(null),r.hide_error()},FVForm.prototype.disable=function(){var e=this;for(var r in e.fields){var t=e.fields[r];t.disable()}},FVForm.prototype.enable=function(){var e=this;for(var r in e.fields){var t=e.fields[r];t.enable()}},FVForm.prototype.val=function(e){var r=this;if(0===arguments.length){var t={};for(var i in r.fields){var n=r.fields[i];n.show_on_form_flag&&(t[i]=n.val())}return t}for(var i in r.fields){var n=r.fields[i];n.val(e[i])}return r},Field.prototype.view_mode=function(){},Field.prototype.edit_mode=function(){},Field.prototype.change_name=function(e){var r=this;return r.name=e,r},Field.prototype.layout=function(){var e=this;e.container.append(e.title,e.element.append(e.input_holder,e.error_message))},Field.prototype.on_change=function(e){var r=this;return r.on_change_callbacks.push(e),r},Field.prototype.hide_on_form=function(){var e=this;return e.show_on_form_flag=!1,e},Field.prototype.show_on_form=function(){var e=this;return e.show_on_form_flag=!0,e},Field.prototype.did_change=function(){for(var e=this,r=e.val(),t=0;t<e.on_change_callbacks.length;t++){var i=e.on_change_callbacks[t];i(r)}return e},Field.prototype.icon=function(){},Field.prototype.val=function(){console.error("Did not override Field.val()")},Field.prototype.disable=function(){},Field.prototype.enable=function(){},Field.prototype.blur=function(){},Field.prototype.focus=function(){},Field.prototype.show_error=function(){var e=this;e.error_message.show()},Field.prototype.hide_error=function(){var e=this;e.error_message.hide()},Field.prototype.error=function(e){var r=this;if(e){if(r.error_message.empty(),4===e.error){for(var t=$("<ul />"),i=0;i<e.errors.length;i++){var n=e.errors[i];t.append($("<li />").text(n.error_message))}r.error_message.append(t)}else r.error_message.append($("<span />").text(e.error_message));r.container&&r.container.addClass("field_error"),r.show_error()}else r.hide_error(),r.container&&r.container.removeClass("field_error")},fieldval_ui_extend(TextField,Field),TextField.prototype.view_mode=function(){var e=this;e.input.prop({readonly:"readonly",disabled:"disabled"}),e.element.addClass("view_mode")},TextField.prototype.edit_mode=function(){var e=this;e.input.prop({readonly:null,disabled:null}),e.element.removeClass("view_mode")},TextField.prototype.icon=function(e){var r=this,t={"background-image":"url("+e.background+")","background-position":e.position,"background-repeat":"no-repeat","padding-left":e.width+"px"};return r.input.css(t),r},TextField.prototype.change_name=function(e){var r=this;return TextField.superClass.change_name.call(this,e),r.input.attr("placeholder",e),r},TextField.prototype.disable=function(){var e=this;return e.input.attr("disabled","disabled"),e},TextField.prototype.enable=function(){var e=this;return e.input.attr("disabled",null),e},TextField.prototype.focus=function(){var e=this;return e.input.focus(),e},TextField.prototype.blur=function(){var e=this;return e.input.blur(),e},TextField.numeric_regex=/^\d+(?:\.\d+)$/,TextField.prototype.val=function(e){var r=this;if(0===arguments.length){var t=r.input.val();return"number"===r.input_type&&TextField.numeric_regex.test(t)?parseFloat(t):0===t.length?null:t}return r.input.val(e),r},fieldval_ui_extend(PasswordField,TextField),fieldval_ui_extend(DisplayField,Field),DisplayField.prototype.icon=function(e){var r=this,t={"background-image":"url("+e.background+")","background-position":e.position,"background-repeat":"no-repeat","padding-left":e.width+"px"};return r.input.css(t),r},DisplayField.prototype.change_name=function(e){var r=this;return DisplayField.superClass.change_name.call(this,e),r},DisplayField.replace_line_breaks=function(e){if("string"!=typeof e)return e;for(var r=[],t=e.split(/\n/),i=jQuery(document.createElement("div")),n=0;n<t.length;n++)r.push(i.text(t[n]).html());return r.join("<br>")},DisplayField.prototype.val=function(e){var r=this;return 0===arguments.length?r.input.text():(r.input.html(DisplayField.replace_line_breaks(e)),r)},fieldval_ui_extend(ChoiceField,Field),ChoiceField.prototype.disable=function(){var e=this;return e.select.attr("disabled","disabled"),e},ChoiceField.prototype.enable=function(){var e=this;return e.select.attr("disabled",null),e},ChoiceField.prototype.focus=function(){var e=this;return e.select.focus(),e},ChoiceField.prototype.blur=function(){var e=this;return e.select.blur(),e},ChoiceField.prototype.val=function(e){var r=this;return 0===arguments.length?r.select.find(":selected").attr("value"):(r.select.val(null!=e?e:r.choice_values[0]),r)},fieldval_ui_extend(DateField,Field),DateField.prototype.icon=function(){var e=this;return e},DateField.prototype.change_name=function(e){var r=this;return DateField.superClass.change_name.call(this,e),r.input.attr("placeholder",e),r},DateField.prototype.disable=function(){var e=this;return e.day_input.attr("disabled","disabled"),e.month_input.attr("disabled","disabled"),e.year_input.attr("disabled","disabled"),e},DateField.prototype.enable=function(){var e=this;return e.day_input.attr("disabled",null),e.month_input.attr("disabled",null),e.year_input.attr("disabled",null),e},DateField.prototype.focus=function(){var e=this;return e.day_input.focus(),e},DateField.prototype.blur=function(){var e=this;return e.day_input.blur(),e.month_input.blur(),e.year_input.blur(),e},DateField.prototype.val=function(e){var r=this;if(0===arguments.length){var t=r.day_input.val(),i=r.month_input.val(),n=r.year_input.val(),o=n+"-"+i+"-"+t;return o}if(null!=e){var t=e.substring(8,10),i=e.substring(5,7),n=e.substring(0,4);r.day_input.val(t),r.month_input.val(i),r.year_input.val(n)}return r},fieldval_ui_extend(BooleanField,Field),BooleanField.prototype.disable=function(){var e=this;return e.input.attr("disabled","disabled"),e},BooleanField.prototype.enable=function(){var e=this;return e.input.attr("disabled",null),e},BooleanField.prototype.focus=function(){var e=this;return e.input.focus(),e},BooleanField.prototype.blur=function(){var e=this;return e.input.blur(),e},BooleanField.prototype.val=function(e){var r=this;return 0===arguments.length?r.input.is(":checked"):(r.input.prop("checked",e),r)},fieldval_ui_extend(ObjectField,Field),ObjectField.prototype.add_field=function(e,r){Form.prototype.add_field.call(this,e,r)},ObjectField.prototype.change_name=function(e){var r=this;return ObjectField.superClass.change_name.call(this,e),r},ObjectField.prototype.view_mode=function(){var e=this;for(var r in e.fields)e.fields[r].view_mode()},ObjectField.prototype.edit_mode=function(){var e=this;for(var r in e.fields)e.fields[r].edit_mode()},ObjectField.prototype.disable=function(){var e=this;return e},ObjectField.prototype.enable=function(){var e=this;return e},ObjectField.prototype.focus=function(){var e=this;return e},ObjectField.prototype.blur=function(){var e=this;return e},ObjectField.prototype.error=function(e){ObjectField.superClass.error.call(this,e),Form.prototype.error.call(this,e)},ObjectField.prototype.fields_error=function(e){Form.prototype.fields_error.call(this,e)},ObjectField.prototype.clear_errors=function(){Form.prototype.clear_errors.call(this)},ObjectField.prototype.val=function(e){var r=this;if(0===arguments.length){var t={};for(var i in r.fields){var n=r.fields[i];t[i]=n.val()}return t}for(var i in e){var n=r.fields[i];n.val(e[i])}return r},"undefined"!=typeof module&&(module.exports={fieldval:FieldVal,bval:BasicVal,rule:ValidationRule});