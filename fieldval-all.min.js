function fieldval_rules_extend(e,r){function t(){}t.prototype=r.prototype,e.prototype=new t,e.prototype.constructor=e,e.superConstructor=r,e.superClass=r.prototype}function TextRuleField(e,r){TextRuleField.superConstructor.call(this,e,r)}function NumberRuleField(e,r){NumberRuleField.superConstructor.call(this,e,r)}function NestedRuleField(e,r){NestedRuleField.superConstructor.call(this,e,r)}function ChoiceRuleField(e,r){ChoiceRuleField.superConstructor.call(this,e,r)}function RuleField(e,r){var t=this;if(t.json=e,t.operators=[],t.validator="undefined"!=typeof r?r:new Validator(e),t.name=t.validator.get("name",BasicVal.string(!1)),t.display_name=t.validator.get("display_name",BasicVal.string(!1)),t.description=t.validator.get("description",BasicVal.string(!1)),t.type=t.validator.get("type",BasicVal.string(!0)),t.required=t.validator.default(!0).get("required",BasicVal.boolean(!1)),null!=e){var i=t.validator.get("exists",BasicVal.boolean(!1));null!=i&&(existsFilter=i?1:2)}}function ValidationRule(){}function fieldval_ui_extend(e,r){function t(){}t.prototype=r.prototype,e.prototype=new t,e.prototype.constructor=e,e.superConstructor=r,e.superClass=r.prototype}function Form(e){var r=this;r.element=$("<form />").addClass("fieldval_ui_form").append(r.error_message=$("<div />").addClass("error_message").hide()).on("submit",function(e){e.preventDefault(),r.submit()}),r.fields=e||{},r.fields_element=r.element,r.submit_callbacks=[]}function Field(e,r){var t=this;t.properties=r||{},t.name=e,t.show_on_form_flag=!0,t.on_change_callbacks=[],t.container=$("<div />").addClass("field_container"),t.element=$("<div />").addClass("field"),t.title=$("<div />").addClass("field_title").text(t.name),t.input_holder=$("<div />").addClass("input_holder"),t.error_message=$("<div />").addClass("error_message").hide(),t.layout()}function TextField(e,r){var t=this;"string"==typeof r&&(t.input_type=r,r=null),t.properties=r||{},t.input_type||(t.input_type=t.properties.type||"text"),TextField.superConstructor.call(this,e),t.element.addClass("text_field"),t.input=$("textarea"===t.input_type?"<textarea />":"text"===t.input_type||"number"===t.input_type?"<input type='text' />":"<input type='"+t.input_type+"' />"),t.input.addClass("text_input").attr("placeholder",e).on("keyup",function(){t.did_change()}).appendTo(t.input_holder)}function PasswordField(e){PasswordField.superConstructor.call(this,e,"password")}function DisplayField(e){var r=this;DisplayField.superConstructor.call(this,e),r.element.addClass("display_field"),r.input=$("<div />").appendTo(r.input_holder),r.hide_on_form()}function ChoiceField(e,r,t){var i=this;if(ChoiceField.superConstructor.call(this,e),i.element.addClass("choice_field"),i.select=$("<select/>").addClass("choice_input").on("change",function(){i.did_change()}).appendTo(i.input_holder),i.choice_values=[],t){var o=$("<option />").attr("value",null).text("");i.select.append(o)}for(var n=0;n<r.length;n++){var a,l,s=r[n];"object"==typeof s?(a=s[0],l=s[1]):a=l=s,i.choice_values.push(a);var o=$("<option />").attr("value",a).text(l);i.select.append(o)}}function DateField(e,r){var t=this;t.format=r,DateField.superConstructor.call(this,e),t.element.addClass("date_field"),t.input_holder.append(t.day_input=$("<input type='number' />").addClass("day_input date_input").attr("placeholder","DD").on("keyup",function(){t.did_change()}),t.month_input=$("<input type='number' />").addClass("month_input date_input").attr("placeholder","MM").on("keyup",function(){t.did_change()}),t.year_input=$("<input type='number' />").addClass("year_input date_input").attr("placeholder","YYYY").on("keyup",function(){t.did_change()}))}function BooleanField(e){var r=this;BooleanField.superConstructor.call(this,e),r.element.addClass("choice_field"),r.input=$("<input type='checkbox' />").addClass("boolean_input").on("change",function(){r.did_change()}).appendTo(r.input_holder)}function ObjectField(e){var r=this;ObjectField.superConstructor.call(this,e),r.element.addClass("object_field"),r.fields_element=r.input_holder,r.fields={}}var logger;"function"==typeof require&&(logger=require("tracer").console()),Validator=function(e){var r=this;r.validating=e,r.missing_keys={},r.missing_count=0,r.invalid_keys={},r.invalid_count=0,r.unrecognized_keys={},r.unrecognized_count=0,r.recognized_keys={},r.errors=[]},Validator.REQUIRED_ERROR="required",Validator.NOT_REQUIRED_BUT_MISSING="notrequired",Validator.ONE_OR_MORE_ERRORS=0,Validator.FIELD_MISSING=1,Validator.INCORRECT_FIELD_TYPE=2,Validator.FIELD_UNRECOGNIZED=3,Validator.MULTIPLE_ERRORS=4,Validator.get_value_and_type=function(e,r){if("integer"==r){var t=parseInt(e);isNaN(t)||(""+t).length!=(""+e).length||(e=t,r=t,r="number")}else if("float"==r){var t=parseFloat(e);isNaN(t)||(e=t,r="number")}var i=typeof e;return"object"==i&&"[object Array]"===Object.prototype.toString.call(e)&&(i="array"),{type:i,desired_type:r,value:e}},Validator.use_operators=function(e,r,t,i){for(var o=!1,n=!1,a=function(r){var l;if("object"==typeof r){if("[object Array]"===Object.prototype.toString.call(r)){for(var s=0;s<r.length&&(a(r[s]),!n);s++);return}if(0==r.length)return;flags=r,l=flags.operator,null!=flags&&flags.stop_if_error&&(stop_if_error=!0)}else l=r,stop_if_error=!0;var u=l(e,function(r){e=r});null!=u&&(t&&(u===Validator.REQUIRED_ERROR?i?t.missing(i):t.error({error_message:"Field missing.",error:Validator.FIELD_MISSING}):u===Validator.NOT_REQUIRED_BUT_MISSING||(i?t.invalid(i,u):t.error(u))),o=!0,stop_if_error&&(n=!0))},l=0;l<r.length;l++){var s=r[l];if(a(s),n)break}return o?void 0:e},Validator.required=function(e,r){var t=function(r){return null==r?e||void 0===e?Validator.REQUIRED_ERROR:Validator.NOT_REQUIRED_BUT_MISSING:void 0};return void 0!==r?(r.operator=t,r):t},Validator.type=function(e,r,t){"object"==typeof r&&(t=r,r="undefined"!=typeof t.required?t.required:!0);var i=function(t,i){var o=Validator.required(r)(t);if(o)return o;var n=Validator.get_value_and_type(t,e),a=n.desired_type,l=n.type,t=n.value;return l!==a?{error_message:"Incorrect field type. Expected "+a+".",error:Validator.INCORRECT_FIELD_TYPE,expected:a,received:l}:void(i&&i(t))};return void 0!==t?(t.operator=i,t):i},Validator.prototype={"default":function(e){var r=this;return{get:function(){var t=r.get.apply(r,arguments);return"undefined"!=typeof t?t:e}}},get:function(e){var r=this,t=r.validating[e];if(r.recognized_keys[e]=!0,arguments.length>1){var i=Array.prototype.slice.call(arguments,1);t=Validator.use_operators(t,i,r,e)}return t},error:function(e){var r=this;return r.errors.push(e),r},invalid:function(e,r){var t=this,i=t.invalid_keys[e];return null!=i?null!=i.errors?i.errors.push(r):t.invalid_keys[e]={error:Validator.MULTIPLE_ERRORS,error_message:"Multiple errors.",errors:[i,r]}:(t.invalid_keys[e]=r,t.invalid_count++),t},missing:function(e){var r=this;return r.missing_keys[e]={error_message:"Field missing.",error:Validator.FIELD_MISSING},r.missing_count++,r},unrecognized:function(e){var r=this;return r.unrecognized_keys[e]={error_message:"Unrecognized field.",error:Validator.FIELD_UNRECOGNIZED},r.unrecognized_count++,r},recognized:function(e){var r=this;return r.recognized_keys[e]=!0,r},get_unrecognized:function(){var e=this,r=[];for(var t in e.validating)1!=e.recognized_keys[t]&&r.push(t);return r},end:function(){var e=this,r={},t=!1,i=e.get_unrecognized();for(var o in i)e.unrecognized(i[o]);if(0!==e.missing_count&&(r.missing=e.missing_keys,t=!0),0!==e.invalid_count&&(r.invalid=e.invalid_keys,t=!0),0!==e.unrecognized_count&&(r.unrecognized=e.unrecognized_keys,t=!0),t){if(r.error_message="One or more errors.",r.error=Validator.ONE_OR_MORE_ERRORS,0===e.errors.length)return r;e.errors.push(r)}return 0!==e.errors.length?1===e.errors.length?e.errors[0]:{error:Validator.MULTIPLE_ERRORS,error_message:"Multiple errors.",errors:e.errors}:null}},Validator.Error=function(e,r,t){if("object"==typeof e&&"[object Array]"===Object.prototype.toString.call(e)){var i=e;e=i[0],r=i[1],t=i[2]}var o={error:e};return null!=r&&(o.error_message=r),null!=t&&(o.data=t),o},"undefined"!=typeof module&&(module.exports=Validator);var _validator_ref;_validator_ref="function"==typeof require?require("fieldval"):Validator;var BasicVal={errors:{too_short:function(e){return{error:100,error_message:"Length is less than "+e}},too_long:function(e){return{error:101,error_message:"Length is greater than "+e}},too_small:function(e){return{error:102,error_message:"Value is less than "+e}},too_large:function(e){return{error:103,error_message:"Value is greater than "+e}},not_in_list:function(){return{error:104,error_message:"Value is not a valid choice"}},cannot_be_empty:function(){return{error:105,error_message:"Value cannot be empty."}},no_prefix:function(e){return{error:106,error_message:"Value does not have prefix: "+e}},invalid_email:function(){return{error:107,error_message:"Invalid email address format."}},invalid_url:function(){return{error:108,error_message:"Invalid url format."}}},integer:function(e,r){return _validator_ref.type("integer",e,r)},number:function(e,r){return _validator_ref.type("number",e,r)},array:function(e,r){return _validator_ref.type("array",e,r)},object:function(e,r){return _validator_ref.type("object",e,r)},"float":function(e,r){return _validator_ref.type("float",e,r)},"boolean":function(e,r){return _validator_ref.type("boolean",e,r)},string:function(e,r){var t=function(t,i){var o=_validator_ref.type("string",e,r)(t,i);return o?o:(r&&r.trim===!1||(t=t.trim()),0===t.length?e||void 0===e?_validator_ref.REQUIRED_ERROR:_validator_ref.NOT_REQUIRED_BUT_MISSING:void 0)};return void 0!==r?(r.operator=t,r):t},min_length:function(e,r){var t=function(r){return r.length<e?BasicVal.errors.too_short(e):void 0};return void 0!==r?(r.operator=t,r):t},max_length:function(e,r){var t=function(r){return r.length>e?BasicVal.errors.too_long(e):void 0};return void 0!==r?(r.operator=t,r):t},minimum:function(e,r){var t=function(r){return e>r?BasicVal.errors.too_small(e):void 0};return void 0!==r?(r.operator=t,r):t},maximum:function(e,r){var t=function(r){return r>e?BasicVal.errors.too_large(e):void 0};return void 0!==r?(r.operator=t,r):t},range:function(e,r,t){var i=function(t){return e>t?BasicVal.errors.too_small(e):t>r?BasicVal.errors.too_large(r):void 0};return void 0!==t?(t.operator=i,t):i},one_of:function(e,r){for(var t=[],i=0;i<e.length;i++){var o=e[i];t.push("object"==typeof o?o[0]:o)}var n=function(e){return-1===t.indexOf(e)?BasicVal.errors.not_in_list():void 0};return void 0!==r?(r.operator=n,r):n},not_empty:function(e,r){var t=function(r){if(e){if(0===r.trim().length)return BasicVal.errors.cannot_be_empty()}else if(0===r.length)return BasicVal.errors.cannot_be_empty()};return void 0!==r?(r.operator=t,r):t},prefix:function(e,r){var t=function(r){return r.length>=e.length?r.substring(0,e.length)!=e?BasicVal.errors.no_prefix(e):void 0:BasicVal.errors.no_prefix(e)};return void 0!==r?(r.operator=t,r):t},each:function(e,r){var t=function(r){for(var t=new _validator_ref(null),i=0;i<r.length;i++){var o=r[i],n=e(o,i);null!=n&&t.invalid(""+i,n)}var a=t.end();return null!=a?a:void 0};return void 0!==r?(r.operator=t,r):t},email:function(e){var r=function(e){var r=BasicVal.email_regex;return r.test(e)?void 0:BasicVal.errors.invalid_email()};return void 0!==e?(e.operator=r,e):r},url:function(e){var r=function(e){var r=BasicVal.url_regex;return r.test(e)?void 0:BasicVal.errors.invalid_url()};return void 0!==e?(e.operator=r,e):r}};BasicVal.email_regex=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,BasicVal.url_regex=/^(https?:\/\/)?([\da-z\.-]+)\.([a-z\.]{2,6})([\/\w \.-]*)*\/?$/,"undefined"!=typeof module&&(module.exports=BasicVal),fieldval_rules_extend(TextRuleField,RuleField),TextRuleField.prototype.create_ui=function(e){var r=this;TextField&&e.add_field(r.name,new TextField(r.display_name||r.name))},TextRuleField.prototype.init=function(){var e=this;return e.min_length=e.validator.get("min_length",BasicVal.integer(!1)),null!=e.min_length&&(e.for_search?fieldErrors.getOrMakeInvalid().put("min_length",new ValidatorError(57).error):e.min_length<1&&fieldErrors.getOrMakeInvalid().put("min_length",new ValidatorError(24).error)),e.max_length=e.validator.get("max_length",BasicVal.integer(!1)),null!=e.max_length&&(e.for_search?fieldErrors.getOrMakeInvalid().put("max_length",new ValidatorError(57).error):e.max_length<1&&fieldErrors.getOrMakeInvalid().put("max_length",new ValidatorError(24).error)),e.phrase=e.validator.get("phrase",BasicVal.string(!1)),null!=e.phrase&&(for_search||fieldErrors.getOrMakeInvalid().put("phrase",new ValidatorError(65).error)),e.equal_to=e.validator.get("equal_to",BasicVal.string(!1)),null!=e.equal_to&&(for_search||fieldErrors.getOrMakeInvalid().put("equal_to",new ValidatorError(65).error)),e.ci_equal_to=e.validator.get("ci_equal_to",BasicVal.string(!1)),null!=e.ci_equal_to&&(for_search||fieldErrors.getOrMakeInvalid().put("ci_equal_to",new ValidatorError(65).error)),e.prefix=e.validator.get("prefix",BasicVal.string(!1)),null!=e.prefix&&(for_search||fieldErrors.getOrMakeInvalid().put("prefix",new ValidatorError(65).error)),e.ci_prefix=e.validator.get("ci_prefix",BasicVal.string(!1)),null!=e.ci_prefix&&(for_search||fieldErrors.getOrMakeInvalid().put("ci_prefix",new ValidatorError(65).error)),e.query=e.validator.get("query",BasicVal.string(!1)),null!=e.query&&(for_search||fieldErrors.getOrMakeInvalid().put("query",new ValidatorError(65).error)),e.validator.end()},TextRuleField.prototype.create_operators=function(){var e=this;e.operators.push(BasicVal.string(e.required)),e.min_length&&e.operators.push(BasicVal.min_length(e.min_length,{stop_on_error:!1})),e.max_length&&e.operators.push(BasicVal.max_length(e.max_length,{stop_on_error:!1}))},fieldval_rules_extend(NumberRuleField,RuleField),NumberRuleField.prototype.create_ui=function(e){var r=this;TextField&&e.add_field(r.name,new TextField(r.display_name||r.name,"number"))},NumberRuleField.prototype.init=function(){var e=this;return e.minimum=e.validator.get("minimum",BasicVal.number(!1)),null!=e.minimum,e.maximum=e.validator.get("maximum",BasicVal.number(!1)),null!=e.maximum,e.integer=e.validator.get("integer",BasicVal.boolean(!1)),e.validator.end()},NumberRuleField.prototype.create_operators=function(){var e=this;e.operators.push(BasicVal.number(e.required)),e.minimum&&e.operators.push(BasicVal.minimum(e.minimum,{stop_on_error:!1})),e.maximum&&e.operators.push(BasicVal.maximum(e.maximum,{stop_on_error:!1})),e.integer&&e.operators.push(BasicVal.integer(!1,{stop_on_error:!1}))},fieldval_rules_extend(NestedRuleField,RuleField),NestedRuleField.prototype.create_ui=function(e,r){var t=this;if(ObjectField){var i;i=r?r:new ObjectField(t.display_name||t.name);for(var o in t.fields){var n=t.fields[o];n.create_ui(i)}r||e.add_field(t.name,i)}},NestedRuleField.prototype.init=function(){var e=this;e.fields={};var r=e.validator.get("fields",BasicVal.object(!1));if(null!=r){var t=new Validator(null);for(var i in r){var o=r[i];o.name||(o.name=i);var n=RuleField.create_field(o),a=n[0],l=n[1];null!=a&&t.invalid(i,a),e.fields[i]=l}var s=t.end();null!=s&&e.validator.invalid("fields",s)}return e.validator.end()},NestedRuleField.prototype.create_operators=function(){var e=this;e.operators.push(BasicVal.object(e.required)),e.operators.push(function(r){var t=new Validator(r);for(var i in e.fields){var o=e.fields[i];o.validate_as_field(i,t)}var n=t.end();return n})},fieldval_rules_extend(ChoiceRuleField,RuleField),ChoiceRuleField.prototype.create_ui=function(e){var r=this;ChoiceField&&e.add_field(r.name,new ChoiceField(r.display_name||r.name,r.choices))},ChoiceRuleField.prototype.init=function(){var e=this;return e.choices=e.validator.get("choices",BasicVal.array(!0)),e.validator.end()},ChoiceRuleField.prototype.create_operators=function(){var e=this;e.operators.push(Validator.required(!0)),e.choices&&e.operators.push(BasicVal.one_of(e.choices,{stop_on_error:!1}))},RuleField.types={text:TextRuleField,number:NumberRuleField,nested:NestedRuleField,choice:ChoiceRuleField},RuleField.create_field=function(e){var r=null,t=new Validator(e),i=t.get("type",BasicVal.string(!0),BasicVal.one_of(["nested","text","number","choice"]));if(!i)return[t.end(),null];var o=RuleField.types[i];r=new o(e,t);var n=r.init();return null!=n?[n,null]:(r.create_operators(),[null,r])},RuleField.prototype.validate_as_field=function(e,r){var t=this,i=r.get(e,t.operators);return i},RuleField.prototype.validate=function(e){var r=this,t=new Validator(null),e=Validator.use_operators(e,r.operators,t);return t.end()},ValidationRule.prototype.init=function(e){var r=this,t=RuleField.create_field(e);return t[0]?t[0]:void(r.field=t[1])},ValidationRule.prototype.create_form=function(){var e=this;if(Form){var r=new Form;return e.field.create_ui(r,r),r}},ValidationRule.prototype.validate=function(e){var r=this,t=r.field.validate(e);return t},"undefined"!=typeof module&&(module.exports=ValidationRule),Form.prototype.on_submit=function(e){var r=this;return r.submit_callbacks.push(e),r},Form.prototype.submit=function(){for(var e=this,r=e.val(),t=0;t<e.submit_callbacks.length;t++){var i=e.submit_callbacks[t];i(r)}return r},Form.prototype.add_field=function(e,r){var t=this;r.container.appendTo(t.fields_element),t.fields[e]=r},Form.prototype.clear_errors=function(){var e=this;e.error(null)},Form.prototype.fields_error=function(e){var r=this;if(e){var t=e.invalid||{},i=e.missing||{},o=e.unrecognized||{};for(var n in r.fields){var a=r.fields[n],l=t[n]||i[n]||o[n]||null;a.error(l)}}else for(var n in r.fields){var a=r.fields[n];a.error(null)}},Form.prototype.show_error=function(){var e=this;e.error_message.show()},Form.prototype.hide_error=function(){var e=this;e.error_message.hide()},Form.prototype.error=function(e){var r=this;if(r.error_message.empty(),e){if(void 0===e.error)return void console.error("No error provided");if(0===e.error)r.fields_error(e),r.hide_error();else{if(4===e.error){for(var t=$("<ul />"),i=0;i<e.errors.length;i++){var o=e.errors[i];0===o.error?r.fields_error(o):t.append($("<li />").text(o.error_message))}r.error_message.append(t)}else r.error_message.append($("<span />").text(e.error_message));r.show_error()}}else r.fields_error(null),r.hide_error()},Form.prototype.disable=function(){var e=this;for(var r in e.fields){var t=e.fields[r];t.disable()}},Form.prototype.enable=function(){var e=this;for(var r in e.fields){var t=e.fields[r];t.enable()}},Form.prototype.val=function(e){var r=this;if(0===arguments.length){var t={};for(var i in r.fields){var o=r.fields[i];o.show_on_form_flag&&(t[i]=o.val())}return t}for(var i in r.fields){var o=r.fields[i];o.val(e[i])}return r},Field.prototype.change_name=function(e){var r=this;return r.name=e,r},Field.prototype.layout=function(){var e=this;e.container.append(e.title,e.element.append(e.input_holder,e.error_message)),e.properties.description&&$("<div />").text(e.properties.description).insertAfter(e.title)},Field.prototype.on_change=function(e){var r=this;return r.on_change_callbacks.push(e),r},Field.prototype.hide_on_form=function(){var e=this;return e.show_on_form_flag=!1,e},Field.prototype.show_on_form=function(){var e=this;return e.show_on_form_flag=!0,e},Field.prototype.did_change=function(){for(var e=this,r=e.val(),t=0;t<e.on_change_callbacks.length;t++){var i=e.on_change_callbacks[t];i(r)}return e},Field.prototype.icon=function(){},Field.prototype.val=function(){console.error("Did not override Field.val()")},Field.prototype.disable=function(){},Field.prototype.enable=function(){},Field.prototype.blur=function(){},Field.prototype.focus=function(){},Field.prototype.show_error=function(){var e=this;e.error_message.show()},Field.prototype.hide_error=function(){var e=this;e.error_message.hide()},Field.prototype.error=function(e){var r=this;if(e){if(r.error_message.empty(),4===e.error){for(var t=$("<ul />"),i=0;i<e.errors.length;i++){var o=e.errors[i];t.append($("<li />").text(o.error_message))}r.error_message.append(t)}else r.error_message.append($("<span />").text(e.error_message));r.container&&r.container.addClass("field_error"),r.show_error()}else r.hide_error(),r.container&&r.container.removeClass("field_error")},fieldval_ui_extend(TextField,Field),TextField.prototype.icon=function(e){var r=this,t={"background-image":"url("+e.background+")","background-position":e.position,"background-repeat":"no-repeat","padding-left":e.width+"px"};return r.input.css(t),r},TextField.prototype.change_name=function(e){var r=this;return TextField.superClass.change_name.call(this,e),r.input.attr("placeholder",e),r},TextField.prototype.disable=function(){var e=this;return e.input.attr("disabled","disabled"),e},TextField.prototype.enable=function(){var e=this;return e.input.attr("disabled",null),e},TextField.prototype.focus=function(){var e=this;return e.input.focus(),e},TextField.prototype.blur=function(){var e=this;return e.input.blur(),e},TextField.numeric_regex=/^-?\d+(\.\d+)?$/,TextField.prototype.val=function(e){var r=this;if(0===arguments.length){var t=r.input.val();return 0===t.length?null:"number"===r.input_type&&TextField.numeric_regex.test(t)?parseFloat(t):t}return r.input.val(e),r},fieldval_ui_extend(PasswordField,TextField),fieldval_ui_extend(DisplayField,Field),DisplayField.prototype.icon=function(e){var r=this,t={"background-image":"url("+e.background+")","background-position":e.position,"background-repeat":"no-repeat","padding-left":e.width+"px"};return r.input.css(t),r},DisplayField.prototype.change_name=function(e){var r=this;return DisplayField.superClass.change_name.call(this,e),r},DisplayField.replace_line_breaks=function(e){if("string"!=typeof e)return e;for(var r=[],t=e.split(/\n/),i=jQuery(document.createElement("div")),o=0;o<t.length;o++)r.push(i.text(t[o]).html());return r.join("<br>")},DisplayField.prototype.val=function(e){var r=this;return 0===arguments.length?r.input.text():(r.input.html(DisplayField.replace_line_breaks(e)),r)},fieldval_ui_extend(ChoiceField,Field),ChoiceField.prototype.disable=function(){var e=this;return e.select.attr("disabled","disabled"),e},ChoiceField.prototype.enable=function(){var e=this;return e.select.attr("disabled",null),e},ChoiceField.prototype.focus=function(){var e=this;return e.select.focus(),e},ChoiceField.prototype.blur=function(){var e=this;return e.select.blur(),e},ChoiceField.prototype.val=function(e){var r=this;return 0===arguments.length?r.select.find(":selected").attr("value"):(null!=e?r.select.val(e):(console.log(e),r.select.val(r.choice_values[0])),r)},fieldval_ui_extend(DateField,Field),DateField.prototype.icon=function(){var e=this;return e},DateField.prototype.change_name=function(e){var r=this;return DateField.superClass.change_name.call(this,e),r.input.attr("placeholder",e),r},DateField.prototype.disable=function(){var e=this;return e.day_input.attr("disabled","disabled"),e.month_input.attr("disabled","disabled"),e.year_input.attr("disabled","disabled"),e},DateField.prototype.enable=function(){var e=this;return e.day_input.attr("disabled",null),e.month_input.attr("disabled",null),e.year_input.attr("disabled",null),e},DateField.prototype.focus=function(){var e=this;return e.day_input.focus(),e},DateField.prototype.blur=function(){var e=this;return e.day_input.blur(),e.month_input.blur(),e.year_input.blur(),e},DateField.prototype.val=function(e){var r=this;if(0===arguments.length){var t=r.day_input.val(),i=r.month_input.val(),o=r.year_input.val(),n=o+"-"+i+"-"+t;return n}if(null!=e){var t=e.substring(8,10),i=e.substring(5,7),o=e.substring(0,4);r.day_input.val(t),r.month_input.val(i),r.year_input.val(o)}return r},fieldval_ui_extend(BooleanField,Field),BooleanField.prototype.disable=function(){var e=this;return e.input.attr("disabled","disabled"),e},BooleanField.prototype.enable=function(){var e=this;return e.input.attr("disabled",null),e},BooleanField.prototype.focus=function(){var e=this;return e.input.focus(),e},BooleanField.prototype.blur=function(){var e=this;return e.input.blur(),e},BooleanField.prototype.val=function(e){var r=this;return 0===arguments.length?r.input.is(":checked"):(r.input.prop("checked",e),r)},fieldval_ui_extend(ObjectField,Field),ObjectField.prototype.add_field=function(e,r){Form.prototype.add_field.call(this,e,r)},ObjectField.prototype.change_name=function(e){var r=this;return ObjectField.superClass.change_name.call(this,e),r},ObjectField.prototype.disable=function(){var e=this;return e},ObjectField.prototype.enable=function(){var e=this;return e},ObjectField.prototype.focus=function(){var e=this;return e},ObjectField.prototype.blur=function(){var e=this;return e},ObjectField.prototype.error=function(e){Form.prototype.fields_error.call(this,e),ObjectField.superClass.error.call(this,e)},ObjectField.prototype.fields_error=function(e){Form.prototype.fields_error.call(this,e)},ObjectField.prototype.clear_errors=function(){Form.prototype.clear_errors.call(this)},ObjectField.prototype.val=function(e){var r=this;if(0===arguments.length){var t={};for(var i in r.fields){var o=r.fields[i];t[i]=o.val()}return t}for(var i in e){var o=r.fields[i];o.val(e[i])}return r},"undefined"!=typeof module&&(module.exports={fieldval:Validator,bval:BasicVal,rule:ValidationRule});