function extend(e,r){function i(){}i.prototype=r.prototype,e.prototype=new i,e.prototype.constructor=e,e.superConstructor=r,e.superClass=r.prototype}function RuleField(e,r){var i=this;if(i.json=e,i.checks=[],i.validator="undefined"!=typeof r?r:new FieldVal(e),i.name=i.validator.get("name",BasicVal.string(!1)),i.display_name=i.validator.get("display_name",BasicVal.string(!1)),i.description=i.validator.get("description",BasicVal.string(!1)),i.type=i.validator.get("type",BasicVal.string(!0)),i.required=i.validator.default(!0).get("required",BasicVal.boolean(!1)),null!=e){var t=i.validator.get("exists",BasicVal.boolean(!1));null!=t&&(existsFilter=t?1:2)}}function BasicRuleField(e,r){BasicRuleField.superConstructor.call(this,e,r)}function TextRuleField(e,r){TextRuleField.superConstructor.call(this,e,r)}function NumberRuleField(e,r){NumberRuleField.superConstructor.call(this,e,r)}function ObjectRuleField(e,r){ObjectRuleField.superConstructor.call(this,e,r)}function ArrayRuleField(e,r){var i=this;ArrayRuleField.superConstructor.call(this,e,r),i.rules=[],i.fields=[]}function ChoiceRuleField(e,r){ChoiceRuleField.superConstructor.call(this,e,r)}function ValidationRule(){}function fieldval_ui_extend(e,r){function i(){}i.prototype=r.prototype,e.prototype=new i,e.prototype.constructor=e,e.superConstructor=r,e.superClass=r.prototype}function FVForm(e){var r=this;r.element=$("<form />").addClass("fv_form").append(r.error_message=$("<div />").addClass("fv_error_message").hide()).on("submit",function(e){e.preventDefault(),r.submit()}),r.fields=e||{},r.fields_element=r.element,r.submit_callbacks=[]}function Field(e){var r=this;r.name=e,r.show_on_form_flag=!0,r.is_in_array=!1,r.on_change_callbacks=[],r.container=$("<div />").addClass("fv_field_container"),r.element=$("<div />").addClass("fv_field"),r.title=$("<div />").addClass("fv_field_title").text(r.name),r.input_holder=$("<div />").addClass("fv_input_holder"),r.error_message=$("<div />").addClass("fv_error_message").hide(),r.layout()}function TextField(e,r){var i=this,t=typeof r;"string"===t?(i.input_type=r,r={}):"object"===t?i.input_type=r.type||"text":r={},i.options=r,TextField.superConstructor.call(this,e),i.element.addClass("fv_text_field"),i.input=$("textarea"===i.input_type?"<textarea />":"text"!==i.input_type&&"number"!==i.input_type&&i.input_type?"<input type='"+i.input_type+"' />":"<input type='text' />"),i.input.addClass("fv_text_input").attr("placeholder",e).on("keyup",function(){i.did_change()}).appendTo(i.input_holder)}function PasswordField(e){PasswordField.superConstructor.call(this,e,"password")}function DisplayField(e){var r=this;DisplayField.superConstructor.call(this,e),r.element.addClass("fv_display_field"),r.input=$("<div />").appendTo(r.input_holder),r.hide_on_form()}function ChoiceField(e,r){var i=this;if(ChoiceField.superConstructor.call(this,e,r),i.properties=r,i.choices=i.properties.choices||[],i.allow_empty=i.properties.allow_empty||!1,i.element.addClass("fv_choice_field"),i.select=$("<select/>").addClass("fv_choice_input").appendTo(i.input_holder),setTimeout(function(){i.select.on("change",function(){i.did_change()})},100),i.choice_values=[],i.allow_empty){var t=$("<option />").attr("value",null).text("");i.select.append(t)}for(var l=0;l<i.choices.length;l++){var n,o,a=i.choices[l];"object"==typeof a?(n=a[0],o=a[1]):n=o=a,i.choice_values.push(n);var t=$("<option />").attr("value",n).text(o);i.select.append(t)}}function DateField(e,r){var i=this;i.format=r,DateField.superConstructor.call(this,e),i.element.addClass("fv_date_field"),i.input_holder.append(i.day_input=$("<input type='number' />").addClass("fv_day_input fv_date_input").attr("placeholder","DD").on("keyup",function(){i.did_change()}),i.month_input=$("<input type='number' />").addClass("fv_month_input fv_date_input").attr("placeholder","MM").on("keyup",function(){i.did_change()}),i.year_input=$("<input type='number' />").addClass("fv_year_input fv_date_input").attr("placeholder","YYYY").on("keyup",function(){i.did_change()}))}function BooleanField(e){var r=this;BooleanField.superConstructor.call(this,e),r.element.addClass("fv_boolean_field"),r.input=$("<input type='checkbox' />").addClass("fv_boolean_input").on("change",function(){r.did_change()}).appendTo(r.input_holder)}function ObjectField(e,r){var i=this;i.options=r||{},ObjectField.superConstructor.call(this,e),i.element.addClass("fv_object_field"),i.fields_element=i.input_holder,i.fields={}}function ArrayField(e,r){var i=this;i.options=r||{},ArrayField.superConstructor.call(this,e),i.element.addClass("fv_array_field"),i.input_holder.append(i.fields_element=$("<div />").addClass("fv_nested_fields"),i.create_add_field_button()),i.fields=[],console.log(i.input_holder)}var logger;"function"==typeof require&&(logger=require("tracer").console()),Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),FieldVal=function(e){var r=this;r.validating=e,r.missing_keys={},r.missing_count=0,r.invalid_keys={},r.invalid_count=0,r.unrecognized_keys={},r.unrecognized_count=0,r.recognized_keys={},r.errors=[]},FieldVal.INCORRECT_TYPE_ERROR=function(e,r){return{error_message:"Incorrect field type. Expected "+e+".",error:FieldVal.INCORRECT_FIELD_TYPE,expected:e,received:r}},FieldVal.MISSING_ERROR=function(){return{error_message:"Field missing.",error:FieldVal.FIELD_MISSING}},FieldVal.REQUIRED_ERROR={},FieldVal.NOT_REQUIRED_BUT_MISSING={},FieldVal.ONE_OR_MORE_ERRORS=0,FieldVal.FIELD_MISSING=1,FieldVal.INCORRECT_FIELD_TYPE=2,FieldVal.FIELD_UNRECOGNIZED=3,FieldVal.MULTIPLE_ERRORS=4,FieldVal.get_value_and_type=function(e,r,i){i||(i={});var t="undefined"!=typeof i.parse?i.parse:!1;if("string"!=typeof e||t)if("integer"==r){var l=parseInt(e);isNaN(l)||(""+l).length!=(""+e).length||(e=l,r=l,r="number")}else if("float"==r){var l=parseFloat(e);isNaN(l)||(e=l,r="number")}var n=typeof e;return"object"==n&&"[object Array]"===Object.prototype.toString.call(e)&&(n="array"),{type:n,desired_type:r,value:e}},FieldVal.use_checks=function(e,r,i,t,l){var n,o=!1,a=!1;i||(n=new FieldVal);for(var u=!1,d=function(r){var l,s=!0,c={};if("object"==typeof r){if(Array.isArray(r)){for(var p=0;p<r.length&&(d(r[p]),!a);p++);return}if(0==r.length)return;c=r,l=c.check,null!=c&&void 0!==c.stop_on_error&&(s=c.stop_on_error)}else l=r,s=!0;var f=l(e,function(r){e=r});if(null!=f){if(f===FieldVal.REQUIRED_ERROR)if(t){if(!i)return f;i.missing(t,c)}else{if(!i)return void(u=!0);i.error(FieldVal.create_error(FieldVal.MISSING_ERROR,c))}else f===FieldVal.NOT_REQUIRED_BUT_MISSING||(i?t?i.invalid(t,f):i.error(f):n.error(f));o=!0,s&&(a=!0)}},s=0;s<r.length;s++){var c=r[s];if(d(c),u)return FieldVal.REQUIRED_ERROR;if(a)break}return o?l&&l(void 0):l&&l(e),i?void 0:n.end()},FieldVal.required=function(e,r){var i=function(r){return null==r?e||void 0===e?FieldVal.REQUIRED_ERROR:FieldVal.NOT_REQUIRED_BUT_MISSING:void 0};return void 0!==r?(r.check=i,r):i},FieldVal.type=function(e,r){var i=void 0!==r.required?r.required:!0,t=function(t,l){var n=FieldVal.required(i)(t);if(n)return n;var o=FieldVal.get_value_and_type(t,e,r),a=o.desired_type,u=o.type,t=o.value;return u!==a?FieldVal.create_error(FieldVal.INCORRECT_TYPE_ERROR,r,a,u):void(l&&l(t))};return void 0!==r?(r.check=t,r):t},FieldVal.prototype.default=function(e){var r=this;return{get:function(){var i=r.get.apply(r,arguments);return"undefined"!=typeof i?i:e}}},FieldVal.prototype.get=function(e){var r=this,i=r.validating[e];if(r.recognized_keys[e]=!0,arguments.length>1){var t=Array.prototype.slice.call(arguments,1);FieldVal.use_checks(i,t,r,e,function(e){i=e})}return i},FieldVal.prototype.error=function(e){var r=this;return r.errors.push(e),r},FieldVal.prototype.invalid=function(e,r){var i=this,t=i.invalid_keys[e];return null!=t?null!=t.errors?t.errors.push(r):i.invalid_keys[e]={error:FieldVal.MULTIPLE_ERRORS,error_message:"Multiple errors.",errors:[t,r]}:(i.invalid_keys[e]=r,i.invalid_count++),i},FieldVal.prototype.missing=function(e,r){var i=this;return i.missing_keys[e]=FieldVal.create_error(FieldVal.MISSING_ERROR,r),i.missing_count++,i},FieldVal.prototype.unrecognized=function(e){var r=this;return r.unrecognized_keys[e]={error_message:"Unrecognized field.",error:FieldVal.FIELD_UNRECOGNIZED},r.unrecognized_count++,r},FieldVal.prototype.recognized=function(e){var r=this;return r.recognized_keys[e]=!0,r},FieldVal.prototype.get_unrecognized=function(){var e=this,r=[];for(var i in e.validating)1!=e.recognized_keys[i]&&r.push(i);return r},FieldVal.prototype.end=function(){var e=this,r={},i=!1,t={},l=0;for(var n in e.unrecognized)t[n]=e.unrecognized[n],l++;for(var o=e.get_unrecognized(),a=0;a<o.length;a++){var n=o[a];t[n]||(t[n]={error_message:"Unrecognized field.",error:FieldVal.FIELD_UNRECOGNIZED},l++)}if(0!==e.missing_count&&(r.missing=e.missing_keys,i=!0),0!==e.invalid_count&&(r.invalid=e.invalid_keys,i=!0),0!==l&&(r.unrecognized=t,i=!0),i){if(r.error_message="One or more errors.",r.error=FieldVal.ONE_OR_MORE_ERRORS,0===e.errors.length)return r;e.errors.push(r)}return 0!==e.errors.length?1===e.errors.length?e.errors[0]:{error:FieldVal.MULTIPLE_ERRORS,error_message:"Multiple errors.",errors:e.errors}:null},FieldVal.create_error=function(e,r){if(!r)return e.apply(null,Array.prototype.slice.call(arguments,2));if(e===FieldVal.MISSING_ERROR){if("function"==typeof r.missing_error)return r.missing_error.apply(null,Array.prototype.slice.call(arguments,2));if("object"==typeof r.missing_error)return r.missing_error;if("string"==typeof r.missing_error)return{error_message:r.missing_error}}else{if("function"==typeof r.error)return r.error.apply(null,Array.prototype.slice.call(arguments,2));if("object"==typeof r.error)return r.error;if("string"==typeof r.error)return{error_message:r.error}}return e.apply(null,Array.prototype.slice.call(arguments,2))},FieldVal.Error=function(e,r,i){if("object"==typeof e&&"[object Array]"===Object.prototype.toString.call(e)){var t=e;e=t[0],r=t[1],i=t[2]}var l={error:e};return null!=r&&(l.error_message=r),null!=i&&(l.data=i),l},"undefined"!=typeof module&&(module.exports=FieldVal);var logger;"function"==typeof require&&(logger=require("tracer").console());var _validator_ref;_validator_ref="function"==typeof require?require("fieldval"):FieldVal;var BasicVal={errors:{too_short:function(e){return{error:100,error_message:"Length is less than "+e}},too_long:function(e){return{error:101,error_message:"Length is greater than "+e}},too_small:function(e){return{error:102,error_message:"Value is less than "+e}},too_large:function(e){return{error:103,error_message:"Value is greater than "+e}},not_in_list:function(){return{error:104,error_message:"Value is not a valid choice"}},cannot_be_empty:function(){return{error:105,error_message:"Value cannot be empty."}},no_prefix:function(e){return{error:106,error_message:"Value does not have prefix: "+e}},invalid_email:function(){return{error:107,error_message:"Invalid email address format."}},invalid_url:function(){return{error:108,error_message:"Invalid url format."}},incorrect_length:function(e){return{error:109,error_message:"Length is not equal to "+e}},no_suffix:function(e){return{error:110,error_message:"Value does not have suffix: "+e}},invalid_date_format:function(){return{error:111,error_message:"Invalid date format."}},invalid_date:function(){return{error:112,error_message:"Invalid date."}}},merge_required_and_flags:function(e,r){return"object"==typeof e?r=e:(r||(r={}),r.required=e),r},integer:function(e,r){return _validator_ref.type("integer",BasicVal.merge_required_and_flags(e,r))},number:function(e,r){return _validator_ref.type("number",BasicVal.merge_required_and_flags(e,r))},array:function(e,r){return _validator_ref.type("array",BasicVal.merge_required_and_flags(e,r))},object:function(e,r){return _validator_ref.type("object",BasicVal.merge_required_and_flags(e,r))},"float":function(e,r){return _validator_ref.type("float",BasicVal.merge_required_and_flags(e,r))},"boolean":function(e,r){return _validator_ref.type("boolean",BasicVal.merge_required_and_flags(e,r))},string:function(e,r){r=BasicVal.merge_required_and_flags(e,r);var i=function(i,t){var l=_validator_ref.type("string",r);"object"==typeof l&&(l=l.check);var n=l(i,t);return n?n:(r&&r.trim===!1||(i=i.trim()),0===i.length?e||void 0===e?_validator_ref.REQUIRED_ERROR:_validator_ref.NOT_REQUIRED_BUT_MISSING:void 0)};return r?(r.check=i,r):{check:i}},length:function(e,r){var i=function(i){return i.length!==e?FieldVal.create_error(BasicVal.errors.incorrect_length,r,e):void 0};return r?(r.check=i,r):{check:i}},min_length:function(e,r){var i=function(i){return i.length<e?FieldVal.create_error(BasicVal.errors.too_short,r,e):void 0};return r?(r.check=i,r):{check:i}},max_length:function(e,r){var i=function(i){return i.length>e?FieldVal.create_error(BasicVal.errors.too_long,r,e):void 0};return r?(r.check=i,r):{check:i}},minimum:function(e,r){var i=function(i){return e>i?FieldVal.create_error(BasicVal.errors.too_small,r,e):void 0};return r?(r.check=i,r):{check:i}},maximum:function(e,r){var i=function(i){return i>e?FieldVal.create_error(BasicVal.errors.too_large,r,e):void 0};return r?(r.check=i,r):{check:i}},range:function(e,r,i){var t=function(t){return e>t?FieldVal.create_error(BasicVal.errors.too_small,i,e):t>r?FieldVal.create_error(BasicVal.errors.too_large,i,r):void 0};return i?(i.check=t,i):{check:t}},one_of:function(e,r){var i=[];if("[object Array]"===Object.prototype.toString.call(e))for(var t=0;t<e.length;t++){var l=e[t];i.push("object"==typeof l?l[0]:l)}else for(var t in e)i.push(t);var n=function(e){return-1===i.indexOf(e)?FieldVal.create_error(BasicVal.errors.not_in_list,r):void 0};return r?(r.check=n,r):{check:n}},not_empty:function(e,r){var i=function(i){if(e){if(0===i.trim().length)return FieldVal.create_error(BasicVal.errors.cannot_be_empty,r)}else if(0===i.length)return FieldVal.create_error(BasicVal.errors.cannot_be_empty,r)};return r?(r.check=i,r):{check:i}},prefix:function(e,r){var i=function(i){return i.length>=e.length?i.substring(0,e.length)!=e?FieldVal.create_error(BasicVal.errors.no_prefix,r,e):void 0:FieldVal.create_error(BasicVal.errors.no_prefix,r,e)};return r?(r.check=i,r):{check:i}},suffix:function(e,r){var i=function(i){return i.length>=e.length?i.substring(i.length-e.length,i.length)!=e?FieldVal.create_error(BasicVal.errors.no_suffix,r,e):void 0:FieldVal.create_error(BasicVal.errors.no_suffix,r,e)};return r?(r.check=i,r):{check:i}},each:function(e,r){var i=function(r){for(var i=new _validator_ref(null),t=0;t<r.length;t++){var l=r[t],n=e(l,t);null!=n&&i.invalid(""+t,n)}var o=i.end();return null!=o?o:void 0};return r?(r.check=i,r):{check:i}},email:function(e){var r=function(r){var i=BasicVal.email_regex;return i.test(r)?void 0:FieldVal.create_error(BasicVal.errors.invalid_email,e)};return e?(e.check=r,e):{check:r}},date:function(e,r){for(var i={YYYY:[4],YY:[2],MM:[2],M:[1,2],DD:[2],D:[1,2]," ":0,"-":0,"/":0,":":0},t=[],l=0,n=!1;l<e.length&&!n;){var o=!1;for(var a in i){var u=e.substring(l,l+a.length);if(u===a){t.push(a),l+=a.length,o=!0;break}}o||(n=!0)}n&&console.error&&console.error("Invalid date format");var d=function(e){for(var l={},n=0,o=null,a=null,u=-1,d=!1;n<e.length&&!d;)if(u++,o=t[u],a=i[o],0!==a){for(var s=a[0],c=a[a.length-1],p="",f=0;c>f;f++){var _=e[n+f];if(void 0===_)break;var v=_.charCodeAt(0);if(48>v||v>57){if(f===s)break;d=!0;break}p+=_}if(n+=f,d)break;var h=parseInt(p);"YYYY"===o||"YY"===o?l.year=h:"MM"===o||"M"===o?l.month=h:("DD"===o||"D"===o)&&(l.day=h)}else{if(e[n]!==o){d=!0;break}n++}if(d)return FieldVal.create_error(BasicVal.errors.invalid_date_format,r);if(void 0!==l.month){var y=l.month;if(y>12)return FieldVal.create_error(BasicVal.errors.invalid_date,r);if(l.day){var m=l.day;if(l.year){var F=l.year;if(2==y)if(F%400==0||F%100!=0&&F%4==0){if(m>29)return FieldVal.create_error(BasicVal.errors.invalid_date,r)}else if(m>28)return FieldVal.create_error(BasicVal.errors.invalid_date,r)}if(4===y||6===y||9===y||11===y){if(m>30)return FieldVal.create_error(BasicVal.errors.invalid_date,r)}else if(2===y){if(m>29)return FieldVal.create_error(BasicVal.errors.invalid_date,r)}else if(m>31)return FieldVal.create_error(BasicVal.errors.invalid_date,r)}}else if(l.day&&l.day>31)return FieldVal.create_error(BasicVal.errors.invalid_date,r)};return r?(r.check=d,r):{check:d}},url:function(e){var r=function(r){var i=BasicVal.url_regex;return i.test(r)?void 0:FieldVal.create_error(BasicVal.errors.invalid_url,e)};return e?(e.check=r,e):{check:r}}};BasicVal.email_regex=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,BasicVal.url_regex=/^(https?):\/\/(((([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5]))|((([a-zA-Z0-9]|[a-zA-Z0-9][a-zA-Z0-9\-]*[a-zA-Z0-9])\.)*([A-Za-z0-9]|[A-Za-z0-9][A-Za-z0-9\-]*[A-Za-z0-9])))(:[1-9][0-9]+)?(\/)?([\/?].+)?$/,"undefined"!=typeof module&&(module.exports=BasicVal),"undefined"!=typeof module&&(module.exports=extend),RuleField.types={},RuleField.add_field_type=function(e){RuleField.types[e.name]={display_name:e.display_name,"class":e.class}},RuleField.create_field=function(e){var r=null,i=BasicVal.object(!0).check(e);if(i)return[i,null];var t=new FieldVal(e),l=t.get("type",BasicVal.string(!0),BasicVal.one_of(RuleField.types));if(!l)return[t.end(),null];var n=RuleField.types[l],o=n.class;r=new o(e,t);var a=r.init();return null!=a?[a,null]:(r.create_checks(),[null,r])},RuleField.prototype.validate_as_field=function(e,r){var i=this,t=r.get(e,i.checks);return t},RuleField.prototype.validate=function(e){var r=this,i=new FieldVal(null),t=FieldVal.use_checks(e,r.checks);return t&&i.error(t),i.end()},RuleField.prototype.make_nested=function(){},RuleField.prototype.init=function(){},RuleField.prototype.remove=function(){},RuleField.prototype.view_mode=function(){},RuleField.prototype.edit_mode=function(){},RuleField.prototype.change_name=function(){},RuleField.prototype.disable=function(){},RuleField.prototype.enable=function(){},RuleField.prototype.focus=function(){},RuleField.prototype.blur=function(){},RuleField.prototype.val=function(){},"undefined"!=typeof module&&(module.exports=RuleField),"function"==typeof require&&(extend=require("extend")),extend(BasicRuleField,RuleField),BasicRuleField.prototype.init=function(){var e=this;return e.ui_field.init.apply(e.ui_field,arguments)},BasicRuleField.prototype.remove=function(){var e=this;return e.ui_field.remove.apply(e.ui_field,arguments)},BasicRuleField.prototype.in_array=function(){var e=this;return e.ui_field.in_array.apply(e.ui_field,arguments)},BasicRuleField.prototype.view_mode=function(){var e=this;return e.ui_field.view_mode.apply(e.ui_field,arguments)},BasicRuleField.prototype.edit_mode=function(){var e=this;return e.ui_field.edit_mode.apply(e.ui_field,arguments)},BasicRuleField.prototype.change_name=function(){var e=this;return e.ui_field.change_name.apply(e.ui_field,arguments)},BasicRuleField.prototype.disable=function(){var e=this;return e.ui_field.disable.apply(e.ui_field,arguments)},BasicRuleField.prototype.val=function(){var e=this;return e.ui_field.val.apply(e.ui_field,arguments)},BasicRuleField.prototype.error=function(){var e=this;return e.ui_field.error.apply(e.ui_field,arguments)},BasicRuleField.prototype.blur=function(){var e=this;return e.ui_field.blur.apply(e.ui_field,arguments)},BasicRuleField.prototype.focus=function(){var e=this;return e.ui_field.blur.apply(e.ui_field,arguments)},"undefined"!=typeof module&&(module.exports=BasicRuleField),"function"==typeof require&&(extend=require("extend"),BasicRuleField=require("./BasicRuleField")),extend(TextRuleField,BasicRuleField),TextRuleField.prototype.create_ui=function(e){var r=this;return r.ui_field=new TextField(r.display_name||r.name,r.json),r.container=r.ui_field.container,e.add_field(r.name,r),r.ui_field},TextRuleField.prototype.init=function(){var e=this;return e.min_length=e.validator.get("min_length",BasicVal.integer(!1)),e.max_length=e.validator.get("max_length",BasicVal.integer(!1)),e.phrase=e.validator.get("phrase",BasicVal.string(!1)),e.equal_to=e.validator.get("equal_to",BasicVal.string(!1)),e.ci_equal_to=e.validator.get("ci_equal_to",BasicVal.string(!1)),e.prefix=e.validator.get("prefix",BasicVal.string(!1)),e.ci_prefix=e.validator.get("ci_prefix",BasicVal.string(!1)),e.query=e.validator.get("query",BasicVal.string(!1)),e.validator.end()},TextRuleField.prototype.create_checks=function(){var e=this;e.checks.push(BasicVal.string(e.required)),e.min_length&&e.checks.push(BasicVal.min_length(e.min_length,{stop_on_error:!1})),e.max_length&&e.checks.push(BasicVal.max_length(e.max_length,{stop_on_error:!1}))},"undefined"!=typeof module&&(module.exports=TextRuleField),"function"==typeof require&&(extend=require("extend"),BasicRuleField=require("./BasicRuleField")),extend(NumberRuleField,BasicRuleField),NumberRuleField.prototype.create_ui=function(e){var r=this;return r.ui_field=new TextField(r.display_name||r.name,r.json),r.container=r.ui_field.container,e.add_field(r.name,r),r.ui_field},NumberRuleField.prototype.val=function(){var e=this;return e.ui_field.val.apply(e.ui_field,arguments)},NumberRuleField.prototype.error=function(){var e=this;return e.ui_field.error.apply(e.ui_field,arguments)},NumberRuleField.prototype.blur=function(){var e=this;return e.ui_field.blur.apply(e.ui_field,arguments)},NumberRuleField.prototype.focus=function(){var e=this;return e.ui_field.blur.apply(e.ui_field,arguments)},NumberRuleField.prototype.init=function(){var e=this;return e.minimum=e.validator.get("minimum",BasicVal.number(!1)),null!=e.minimum,e.maximum=e.validator.get("maximum",BasicVal.number(!1)),null!=e.maximum,e.integer=e.validator.get("integer",BasicVal.boolean(!1)),e.validator.end()},NumberRuleField.prototype.create_checks=function(){var e=this;e.checks.push(BasicVal.number(e.required)),e.minimum&&e.checks.push(BasicVal.minimum(e.minimum,{stop_on_error:!1})),e.maximum&&e.checks.push(BasicVal.maximum(e.maximum,{stop_on_error:!1})),e.integer&&e.checks.push(BasicVal.integer(!1,{stop_on_error:!1}))},"undefined"!=typeof module&&(module.exports=NumberRuleField),"function"==typeof require&&(extend=require("extend"),BasicRuleField=require("./BasicRuleField")),extend(ObjectRuleField,BasicRuleField),ObjectRuleField.prototype.create_ui=function(e,r){var i=this;if(i.json.any)i.ui_field=new TextField(i.display_name||i.name,{type:"textarea"}),i.ui_field.val=function(e){var r=this;if(0===arguments.length){var i=r.input.val();if(0===i.length)return null;try{return JSON.parse(i)}catch(t){console.error("FAILED TO PARSE: ",i)}return i}return r.input.val(JSON.stringify(e,null,4)),r},i.container=i.ui_field.container;else{i.ui_field=r?r:new ObjectField(i.display_name||i.name,i.json);for(var t in i.fields){var l=i.fields[t];l.create_ui(i.ui_field)}i.container=i.ui_field.container}return r||e.add_field(i.name,i.ui_field),i.ui_field},ObjectRuleField.prototype.val=function(){var e=this;return e.ui_field.val.apply(e.ui_field,arguments)},ObjectRuleField.prototype.error=function(){var e=this;return e.ui_field.error.apply(e.ui_field,arguments)},ObjectRuleField.prototype.blur=function(){var e=this;return e.ui_field.blur.apply(e.ui_field,arguments)},ObjectRuleField.prototype.focus=function(){var e=this;return e.ui_field.blur.apply(e.ui_field,arguments)},ObjectRuleField.prototype.init=function(){var e=this;e.fields={},e.any=e.validator.get("any",BasicVal.boolean(!1));var r=e.validator.get("fields",BasicVal.array(!1));if(null!=r){for(var i=new FieldVal(null),t=0;t<r.length;t++){var l=r[t],n=RuleField.create_field(l),o=n[0],a=n[1];null==o?e.fields[a.name]=a:i.invalid(t,o)}var u=i.end();null!=u&&e.validator.invalid("indices",u)}return e.validator.end()},ObjectRuleField.prototype.create_checks=function(){var e=this;e.checks.push(BasicVal.object(e.required)),e.any||e.checks.push(function(r){var i=new FieldVal(r);for(var t in e.fields){var l=e.fields[t];l.validate_as_field(t,i)}var n=i.end();return n})},"undefined"!=typeof module&&(module.exports=ObjectRuleField),"function"==typeof require&&(extend=require("extend"),BasicRuleField=require("./BasicRuleField")),extend(ArrayRuleField,BasicRuleField),ArrayRuleField.prototype.create_ui=function(e){var r=this;r.ui_field=new ArrayField(r.display_name||r.name,r.json),r.ui_field.new_field=function(e){return r.new_field(e)};var i=r.ui_field.remove_field;return r.ui_field.remove_field=function(e){for(var t=0;t<r.fields.length;t++)r.fields[t]===e&&r.fields.splice(t,1);return i.call(r.ui_field,e)},r.container=r.ui_field.container,e.add_field(r.name,r),r.ui_field},ArrayRuleField.prototype.new_field=function(e){var r=this,i=r.rules[e];if(!i){{var t=r.rule_for_index(e),l=RuleField.create_field(t);l[0]}i=l[1],r.rules[e]=i}return i.create_ui(r.ui_field)},ArrayRuleField.prototype.rule_for_index=function(e){var r=this,i=r.indices[e];return i||(i=r.indices["*"]),i},ArrayRuleField.prototype.val=function(){var e=this;return e.ui_field.val.apply(e.ui_field,arguments)},ArrayRuleField.prototype.error=function(){var e=this;return e.ui_field.error.apply(e.ui_field,arguments)},ArrayRuleField.prototype.blur=function(){var e=this;return e.ui_field.blur.apply(e.ui_field,arguments)},ArrayRuleField.prototype.focus=function(){var e=this;return e.ui_field.blur.apply(e.ui_field,arguments)},ArrayRuleField.prototype.init=function(){var e=this;e.indices={};var r=e.validator.get("indices",BasicVal.object(!1));if(null!=r){var i=new FieldVal(null);for(var t in r){var l=r[t],n=RuleField.create_field(l),o=n[0];console.log(o),null==o?e.indices[t]=l:i.invalid(t,o)}var a=i.end();a&&e.validator.invalid("indices",a)}return e.validator.end()},ArrayRuleField.prototype.create_checks=function(){var e=this;e.checks.push(BasicVal.array(e.required)),e.checks.push(function(r){for(var i=new FieldVal(r),t=0;t<r.length;t++){var l=e.rules[t];l.validate_as_field(t,i)}var n=i.end();return n})},"undefined"!=typeof module&&(module.exports=ArrayRuleField),"function"==typeof require&&(extend=require("extend"),BasicRuleField=require("./BasicRuleField")),extend(ChoiceRuleField,BasicRuleField),ChoiceRuleField.prototype.create_ui=function(e){var r=this;return r.ui_field=new ChoiceField(r.display_name||r.name,r.choices,r.json),r.container=r.ui_field.container,e.add_field(r.name,r),r.ui_field},ChoiceRuleField.prototype.val=function(){var e=this;return e.ui_field.val.apply(e.ui_field,arguments)},ChoiceRuleField.prototype.error=function(){var e=this;return e.ui_field.error.apply(e.ui_field,arguments)},ChoiceRuleField.prototype.blur=function(){var e=this;return e.ui_field.blur.apply(e.ui_field,arguments)},ChoiceRuleField.prototype.focus=function(){var e=this;return e.ui_field.blur.apply(e.ui_field,arguments)},ChoiceRuleField.prototype.init=function(){var e=this;return e.choices=e.validator.get("choices",BasicVal.array(!0)),e.validator.end()},ChoiceRuleField.prototype.create_checks=function(){var e=this;e.checks.push(FieldVal.required(!0)),e.choices&&e.checks.push(BasicVal.one_of(e.choices,{stop_on_error:!1}))},"undefined"!=typeof module&&(module.exports=ChoiceRuleField),"function"==typeof require&&(FieldVal=require("fieldval"),BasicVal=require("fieldval-basicval"),RuleField=require("./fields/RuleField")),RuleField.add_field_type({name:"text",display_name:"Text","class":"undefined"!=typeof TextRuleField?TextRuleField:require("./fields/TextRuleField")}),RuleField.add_field_type({name:"string",display_name:"String","class":"undefined"!=typeof TextRuleField?TextRuleField:require("./fields/TextRuleField")}),RuleField.add_field_type({name:"number",display_name:"Number","class":"undefined"!=typeof NumberRuleField?NumberRuleField:require("./fields/NumberRuleField")}),RuleField.add_field_type({name:"object",display_name:"Object","class":"undefined"!=typeof ObjectRuleField?ObjectRuleField:require("./fields/ObjectRuleField")}),RuleField.add_field_type({name:"array",display_name:"Array","class":"undefined"!=typeof ArrayRuleField?ArrayRuleField:require("./fields/ArrayRuleField")}),RuleField.add_field_type({name:"choice",display_name:"Choice","class":"undefined"!=typeof ChoiceRuleField?ChoiceRuleField:require("./fields/ChoiceRuleField")}),ValidationRule.RuleField=RuleField,ValidationRule.prototype.init=function(e){var r=this,i=RuleField.create_field(e);return i[0]?i[0]:void(r.field=i[1])},ValidationRule.prototype.create_form=function(){var e=this;if(FVForm){var r=new FVForm;return e.field.create_ui(r,r),r}},ValidationRule.prototype.validate=function(e){var r=this,i=r.field.validate(e);return i},"undefined"!=typeof module&&(module.exports=ValidationRule),FVForm.button_event="click",FVForm.prototype.init=function(){var e=this;for(var r in e.fields){var i=e.fields[r];i.init()}},FVForm.prototype.remove=function(){var e=this;for(var r in e.fields){var i=e.fields[r];i.remove()}},FVForm.prototype.blur=function(){var e=this;for(var r in e.fields){var i=e.fields[r];i.blur()}return e},FVForm.prototype.edit_mode=function(){var e=this;for(var r in e.fields)e.fields[r].edit_mode();return e},FVForm.prototype.view_mode=function(){var e=this;for(var r in e.fields)e.fields[r].view_mode();return e},FVForm.prototype.on_submit=function(e){var r=this;return r.submit_callbacks.push(e),r},FVForm.prototype.submit=function(){for(var e=this,r=e.val(),i=0;i<e.submit_callbacks.length;i++){var t=e.submit_callbacks[i];t(r)}return r},FVForm.prototype.add_field=function(e,r){var i=this;return r.container.appendTo(i.fields_element),i.fields[e]=r,i},FVForm.prototype.remove_field=function(e){var r=this,i=r.fields[e];i&&(i.remove(),delete r.fields[e])},FVForm.prototype.clear_errors=function(){var e=this;e.error(null)},FVForm.prototype.fields_error=function(e){var r=this;if(e){var i=e.invalid||{},t=e.missing||{},l=e.unrecognized||{};for(var n in r.fields){var o=r.fields[n],a=i[n]||t[n]||l[n]||null;o.error(a)}}else for(var n in r.fields){var o=r.fields[n];o.error(null)}},FVForm.prototype.show_error=function(){var e=this;e.error_message.show()},FVForm.prototype.hide_error=function(){var e=this;e.error_message.hide()},FVForm.prototype.error=function(e){var r=this;if(r.error_message.empty(),e){if(void 0===e.error)return void console.error("No error provided");if(0===e.error)r.fields_error(e),r.hide_error();else{if(4===e.error){for(var i=$("<ul />"),t=0;t<e.errors.length;t++){var l=e.errors[t];0===l.error?r.fields_error(l):i.append($("<li />").text(l.error_message))}r.error_message.append(i)}else r.error_message.append($("<span />").text(e.error_message));r.show_error()}}else r.fields_error(null),r.hide_error()},FVForm.prototype.disable=function(){var e=this;for(var r in e.fields){var i=e.fields[r];i.disable()}},FVForm.prototype.enable=function(){var e=this;for(var r in e.fields){var i=e.fields[r];i.enable()}},FVForm.prototype.val=function(e){var r=this;if(0===arguments.length){var i={};for(var t in r.fields){var l=r.fields[t];if(l.show_on_form_flag!==!1){var n=l.val();null!=n&&(i[t]=n)}}return i}for(var t in r.fields){var l=r.fields[t];l.val(e[t])}return r},Field.prototype.in_array=function(e){var r=this;r.is_in_array=!0,r.element.addClass("fv_nested").append($("<button />").addClass("fv_field_remove_button").text("X").on(FVForm.button_event,function(i){i.preventDefault(),e(),r.remove()}))},Field.prototype.init=function(){},Field.prototype.remove=function(){var e=this;e.container.remove()},Field.prototype.view_mode=function(){},Field.prototype.edit_mode=function(){},Field.prototype.change_name=function(e){var r=this;return r.name=e,r},Field.prototype.layout=function(){var e=this;e.container.append(e.title,e.element.append(e.input_holder,e.error_message))},Field.prototype.on_change=function(e){var r=this;return r.on_change_callbacks.push(e),r},Field.prototype.hide_on_form=function(){var e=this;return e.show_on_form_flag=!1,e},Field.prototype.show_on_form=function(){var e=this;return e.show_on_form_flag=!0,e},Field.prototype.did_change=function(){for(var e=this,r=e.val(),i=0;i<e.on_change_callbacks.length;i++){var t=e.on_change_callbacks[i];
t(r)}return e},Field.prototype.icon=function(){},Field.prototype.val=function(){console.error("Did not override Field.val()")},Field.prototype.disable=function(){},Field.prototype.enable=function(){},Field.prototype.blur=function(){},Field.prototype.focus=function(){},Field.prototype.show_error=function(){var e=this;e.error_message.show()},Field.prototype.hide_error=function(){var e=this;e.error_message.hide()},Field.prototype.error=function(e){var r=this;if(e){if(r.error_message.empty(),4===e.error){for(var i=$("<ul />"),t=0;t<e.errors.length;t++){var l=e.errors[t];i.append($("<li />").text(l.error_message))}r.error_message.append(i)}else r.error_message.append($("<span />").text(e.error_message));r.container&&r.container.addClass("fv_field_error"),r.show_error()}else r.hide_error(),r.container&&r.container.removeClass("fv_field_error")},fieldval_ui_extend(TextField,Field),TextField.prototype.view_mode=function(){var e=this;e.input.prop({readonly:"readonly",disabled:"disabled"}),e.element.addClass("fv_view_mode")},TextField.prototype.edit_mode=function(){var e=this;e.input.prop({readonly:null,disabled:null}),e.element.removeClass("fv_view_mode")},TextField.prototype.icon=function(e){var r=this,i={"background-image":"url("+e.background+")","background-position":e.position,"background-repeat":"no-repeat","padding-left":e.width+"px"};return r.input.css(i),r},TextField.prototype.change_name=function(e){var r=this;return TextField.superClass.change_name.call(this,e),r.input.attr("placeholder",e),r},TextField.prototype.disable=function(){var e=this;return e.input.attr("disabled","disabled"),e},TextField.prototype.enable=function(){var e=this;return e.input.attr("disabled",null),e},TextField.prototype.focus=function(){var e=this;return e.input.focus(),e},TextField.prototype.blur=function(){var e=this;return e.input.blur(),e},TextField.numeric_regex=/^\d+(\.\d+)?$/,TextField.prototype.val=function(e){var r=this;if(0===arguments.length){var i=r.input.val();return"number"===r.input_type&&TextField.numeric_regex.test(i)?parseFloat(i):0===i.length?null:i}return r.input.val(e),r},fieldval_ui_extend(PasswordField,TextField),fieldval_ui_extend(DisplayField,Field),DisplayField.prototype.icon=function(e){var r=this,i={"background-image":"url("+e.background+")","background-position":e.position,"background-repeat":"no-repeat","padding-left":e.width+"px"};return r.input.css(i),r},DisplayField.prototype.change_name=function(e){var r=this;return DisplayField.superClass.change_name.call(this,e),r},DisplayField.replace_line_breaks=function(e){if("string"!=typeof e)return e;for(var r=[],i=e.split(/\n/),t=jQuery(document.createElement("div")),l=0;l<i.length;l++)r.push(t.text(i[l]).html());return r.join("<br>")},DisplayField.prototype.val=function(e){var r=this;return 0===arguments.length?r.input.text():(r.input.html(DisplayField.replace_line_breaks(e)),r)},fieldval_ui_extend(ChoiceField,Field),ChoiceField.prototype.disable=function(){var e=this;return e.select.attr("disabled","disabled"),e},ChoiceField.prototype.enable=function(){var e=this;return e.select.attr("disabled",null),e},ChoiceField.prototype.focus=function(){var e=this;return e.select.focus(),e},ChoiceField.prototype.blur=function(){var e=this;return e.select.blur(),e},ChoiceField.prototype.val=function(e){var r=this;if(0===arguments.length){var i=r.select.find(":selected"),t=i.index()-(r.allow_empty?1:0);return r.allow_empty&&-1===t?null:r.choice_values[t]}return r.select.val(null!=e?e:r.choice_values[0]),r},fieldval_ui_extend(DateField,Field),DateField.prototype.icon=function(){var e=this;return e},DateField.prototype.change_name=function(e){var r=this;return DateField.superClass.change_name.call(this,e),r.input.attr("placeholder",e),r},DateField.prototype.disable=function(){var e=this;return e.day_input.attr("disabled","disabled"),e.month_input.attr("disabled","disabled"),e.year_input.attr("disabled","disabled"),e},DateField.prototype.enable=function(){var e=this;return e.day_input.attr("disabled",null),e.month_input.attr("disabled",null),e.year_input.attr("disabled",null),e},DateField.prototype.focus=function(){var e=this;return e.day_input.focus(),e},DateField.prototype.blur=function(){var e=this;return e.day_input.blur(),e.month_input.blur(),e.year_input.blur(),e},DateField.prototype.val=function(e){var r=this;if(0===arguments.length){var i=r.day_input.val(),t=r.month_input.val(),l=r.year_input.val(),n=l+"-"+t+"-"+i;return n}if(null!=e){var i=e.substring(8,10),t=e.substring(5,7),l=e.substring(0,4);r.day_input.val(i),r.month_input.val(t),r.year_input.val(l)}return r},fieldval_ui_extend(BooleanField,Field),BooleanField.prototype.disable=function(){var e=this;return e.input.attr("disabled","disabled"),e},BooleanField.prototype.enable=function(){var e=this;return e.input.attr("disabled",null),e},BooleanField.prototype.focus=function(){var e=this;return e.input.focus(),e},BooleanField.prototype.blur=function(){var e=this;return e.input.blur(),e},BooleanField.prototype.val=function(e){var r=this;return 0===arguments.length?r.input.is(":checked"):(r.input.prop("checked",e),r)},fieldval_ui_extend(ObjectField,Field),ObjectField.prototype.init=function(){FVForm.prototype.init.call(this)},ObjectField.prototype.remove=function(){FVForm.prototype.remove.call(this),Field.prototype.remove.call(this)},ObjectField.prototype.add_field=function(e,r){FVForm.prototype.add_field.call(this,e,r)},ObjectField.prototype.change_name=function(e){var r=this;return ObjectField.superClass.change_name.call(this,e),r},ObjectField.prototype.view_mode=function(){var e=this;for(var r in e.fields)e.fields[r].view_mode()},ObjectField.prototype.edit_mode=function(){var e=this;for(var r in e.fields)e.fields[r].edit_mode()},ObjectField.prototype.disable=function(){var e=this;return e},ObjectField.prototype.enable=function(){var e=this;return e},ObjectField.prototype.focus=function(){var e=this;return e},ObjectField.prototype.blur=function(){FVForm.prototype.blur.call(this)},ObjectField.prototype.error=function(e){ObjectField.superClass.error.call(this,e),FVForm.prototype.error.call(this,e)},ObjectField.prototype.fields_error=function(e){FVForm.prototype.fields_error.call(this,e)},ObjectField.prototype.clear_errors=function(){FVForm.prototype.clear_errors.call(this)},ObjectField.prototype.val=function(e){var r=this;if(0===arguments.length){var i={};for(var t in r.fields){var l=r.fields[t];i[t]=l.val()}return i}for(var t in e){var l=r.fields[t];l&&l.val(e[t])}return r},fieldval_ui_extend(ArrayField,Field),ArrayField.prototype.create_add_field_button=function(){var e=this;return $("<button />").addClass("fv_add_field_button").text("+").on(FVForm.button_event,function(r){r.preventDefault(),e.new_field(e.fields.length)})},ArrayField.prototype.new_field=function(){console.error("ArrayField.new_field must be overriden to create fields")},ArrayField.prototype.add_field=function(e,r){var i=this;r.in_array(function(){i.remove_field(r)}),r.container.appendTo(i.fields_element),i.fields.push(r)},ArrayField.prototype.remove_field=function(e){for(var r=this,i=0;i<r.fields.length;i++)r.fields[i]===e&&r.fields.splice(i,1)},ArrayField.prototype.view_mode=function(){var e=this;for(var r in e.fields)e.fields[r].view_mode()},ArrayField.prototype.edit_mode=function(){var e=this;for(var r in e.fields)e.fields[r].edit_mode()},ArrayField.prototype.error=function(e){ArrayField.superClass.error.call(this,e)},ArrayField.prototype.fields_error=function(e){var r=this;if(e)for(var i=e.invalid||{},t=e.missing||{},l=e.unrecognized||{},n=0;n<r.fields.length;n++){var o=r.fields[n],a=i[n]||t[n]||l[n]||null;o.error(a)}else for(var n in r.fields){var o=r.fields[n];o.error(null)}},ArrayField.prototype.clear_errors=function(){},ArrayField.prototype.error=function(e){var r=this;if(r.error_message.empty(),e){if(void 0===e.error)return void console.error("No error provided");if(0===e.error)r.fields_error(e),r.hide_error();else{if(4===e.error){for(var i=$("<ul />"),t=0;t<e.errors.length;t++){var l=e.errors[t];0===l.error?r.fields_error(l):i.append($("<li />").text(l.error_message))}r.error_message.append(i)}else r.error_message.append($("<span />").text(e.error_message));r.show_error()}}else r.fields_error(null),r.hide_error()},ArrayField.prototype.val=function(e){var r=this;if(0===arguments.length){for(var i=[],t=0;t<r.fields.length;t++){var l=r.fields[t],n=l.val();i.push(n)}return i}if(e)for(var t=0;t<e.length;t++){var l=r.fields[t];l||(l=r.new_field(t)),l.val(e[t])}return r},"undefined"!=typeof module&&(module.exports={fieldval:FieldVal,bval:BasicVal,rule:ValidationRule});